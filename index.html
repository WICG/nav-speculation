<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>Prerendering Revamped</title>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
<style data-fill-with="stylesheet">/******************************************************************************
 *                   Style sheet for the W3C specifications                   *
 *
 * Special classes handled by this style sheet include:
 *
 * Indices
 *   - .toc for the Table of Contents (<ol class="toc">)
 *     + <span class="secno"> for the section numbers
 *   - #toc for the Table of Contents (<nav id="toc">)
 *   - ul.index for Indices (<a href="#ref">term</a><span>, in §N.M</span>)
 *   - table.index for Index Tables (e.g. for properties or elements)
 *
 * Structural Markup
 *   - table.data for general data tables
 *     -> use 'scope' attribute, <colgroup>, <thead>, and <tbody> for best results !
 *     -> use <table class='complex data'> for extra-complex tables
 *     -> use <td class='long'> for paragraph-length cell content
 *     -> use <td class='pre'> when manual line breaks/indentation would help readability
 *   - dl.switch for switch statements
 *   - ol.algorithm for algorithms (helps to visualize nesting)
 *   - .figure and .caption (HTML4) and figure and figcaption (HTML5)
 *     -> .sidefigure for right-floated figures
 *   - ins/del
 *     -> ins/del.c### for candidate and proposed changes (amendments)
 *
 * Code
 *   - pre and code
 *
 * Special Sections
 *   - .note       for informative notes             (div, p, span, aside, details)
 *   - .example    for informative examples          (div, p, pre, span)
 *   - .issue      for issues                        (div, p, span)
 *   - .advisement for loud normative statements     (div, p, strong)
 *   - .annoying-warning for spec obsoletion notices (div, aside, details)
 *   - .correction for "candidate corrections"       (div, aside, details, section)
 *   - .addition   for "candidate additions"         (div, aside, details, section)
 *   - .correction.proposed for "proposed corrections" (div, aside, details, section)
 *   - .addition.proposed   for "proposed additions"   (div, aside, details, section)
 *
 * Definition Boxes
 *   - pre.def   for WebIDL definitions
 *   - table.def for tables that define other entities (e.g. CSS properties)
 *   - dl.def    for definition lists that define other entitles (e.g. HTML elements)
 *
 * Numbering
 *   - .secno for section numbers in .toc and headings (<span class='secno'>3.2</span>)
 *   - .marker for source-inserted example/figure/issue numbers (<span class='marker'>Issue 4</span>)
 *   - ::before styled for CSS-generated issue/example/figure numbers:
 *     -> Documents wishing to use this only need to add
 *        figcaption::before,
 *        .caption::before { content: "Figure "  counter(figure) " ";  }
 *        .example::before { content: "Example " counter(example) " "; }
 *        .issue::before   { content: "Issue "   counter(issue) " ";   }
 *
 * Header Stuff (ignore, just don't conflict with these classes)
 *   - .head for the header
 *   - .copyright for the copyright
 *
 * Outdated warning for old specs
 *
 * Miscellaneous
 *   - .overlarge for things that should be as wide as possible, even if
 *     that overflows the body text area. This can be used on an item or
 *     on its container, depending on the effect desired.
 *     Note that this styling basically doesn't help at all when printing,
 *     since A4 paper isn't much wider than the max-width here.
 *     It's better to design things to fit into a narrower measure if possible.
 *
 *   - js-added ToC jump links (see fixup.js)
 *
 ******************************************************************************/

/* color variables included separately for reliability */

/******************************************************************************/
/*                                    Body                                    */
/******************************************************************************/

	html {
	}

	body {
		counter-reset: example figure issue;

		/* Layout */
		max-width: 50em;			  /* limit line length to 50em for readability   */
		margin: 0 auto;				/* center text within page                    */
		padding: 1.6em 1.5em 2em 50px; /* assume 16px font size for downlevel clients */
		padding: 1.6em 1.5em 2em calc(26px + 1.5em); /* leave space for status flag    */

		/* Typography */
		line-height: 1.5;
		font-family: sans-serif;
		widows: 2;
		orphans: 2;
		word-wrap: break-word;
		overflow-wrap: break-word;
		hyphens: auto;

		color: black;
		color: var(--text);
		background: white top left fixed no-repeat;
		background: var(--bg) top left fixed no-repeat;
		background-size: 25px auto;
	}


/******************************************************************************/
/*                         Front Matter & Navigation                          */
/******************************************************************************/

/** Header ********************************************************************/

	div.head { margin-bottom: 1em; }
	div.head hr { border-style: solid; }

	div.head h1 {
		font-weight: bold;
		margin: 0 0 .1em;
		font-size: 220%;
	}

	div.head h2 { margin-bottom: 1.5em;}

/** W3C Logo ******************************************************************/

	.head .logo {
		float: right;
		margin: 0.4rem 0 0.2rem .4rem;
	}

	.head img[src*="logos/W3C"] {
		display: block;
		border: solid #1a5e9a;
		border: solid var(--logo-bg);
		border-width: .65rem .7rem .6rem;
		border-radius: .4rem;
		background: #1a5e9a;
		background: var(--logo-bg);
		color: white;
		color: var(--logo-text);
		font-weight: bold;
	}

	.head a:hover > img[src*="logos/W3C"],
	.head a:focus > img[src*="logos/W3C"] {
		opacity: .8;
	}

	.head a:active > img[src*="logos/W3C"] {
		background: #c00;
		background: var(--logo-active-bg);
		border-color: #c00;
		border-color: var(--logo-active-bg);
	}

	/* see also additional rules in Link Styling section */

/** Copyright *****************************************************************/

	p.copyright,
	p.copyright small { font-size: small; }

/** Back to Top / ToC Toggle **************************************************/

	@media print {
		#toc-nav {
			display: none;
		}
	}
	@media not print {
		#toc-nav {
			position: fixed;
			z-index: 3;
			bottom: 0; left: 0;
			margin: 0;
			min-width: 1.33em;
			border-top-right-radius: 2rem;
			box-shadow: 0 0 2px;
			font-size: 1.5em;
		}
		#toc-nav > a {
			display: block;
			white-space: nowrap;

			height: 1.33em;
			padding: .1em 0.3em;
			margin: 0;

			box-shadow: 0 0 2px;
			border: none;
			border-top-right-radius: 1.33em;

			color: #707070;
			color: var(--tocnav-normal-text);
			background: white;
			background: var(--tocnav-normal-bg);
		}
		#toc-nav > a:hover,
		#toc-nav > a:focus {
			color: black;
			color: var(--tocnav-hover-text);
			background: #f8f8f8;
			background: var(--tocnav-hover-bg);
		}
		#toc-nav > a:active {
			color: #c00;
			color: var(--tocnav-active-text);
			background: white;
			background: var(--tocnav-active-bg);
		}

		#toc-nav > #toc-jump {
			padding-bottom: 2em;
			margin-bottom: -1.9em;
		}

		/* statusbar gets in the way on keyboard focus; remove once browsers fix */
		#toc-nav > a[href="#toc"]:not(:hover):focus:last-child {
			padding-bottom: 1.5rem;
		}

		#toc-nav:not(:hover) > a:not(:focus) > span + span {
			/* Ideally this uses :focus-within on #toc-nav */
			display: none;
		}
		#toc-nav > a > span + span {
			padding-right: 0.2em;
		}
	}

/** ToC Sidebar ***************************************************************/

	/* Floating sidebar */
	@media screen {
		body.toc-sidebar #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			max-width: 80%;
			max-width: calc(100% - 2em - 26px);
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			color: black;
			color: var(--tocsidebar-text);
			background: inherit;
			background-color: #f7f8f9;
			background-color: var(--tocsidebar-bg);
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
			box-shadow: -.1em 0 .25em var(--tocsidebar-shadow) inset;
		}
		body.toc-sidebar #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
			color: var(--tocsidebar-heading-text);
		}
		body.toc-sidebar #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	/* Hide main scroller when only the ToC is visible anyway */
	@media screen and (max-width: 28em) {
		body.toc-sidebar {
			overflow: hidden;
		}
	}

	/* Sidebar with its own space */
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			color: black;
			color: var(--tocsidebar-text);
			background: inherit;
			background-color: #f7f8f9;
			background-color: var(--tocsidebar-bg);
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
			box-shadow: -.1em 0 .25em var(--tocsidebar-shadow) inset;
		}
		body:not(.toc-inline) #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
			color: var(--tocsidebar-heading-text);
		}

		body:not(.toc-inline) {
			padding-left: 29em;
		}
		/* See also Overflow section at the bottom */

		body:not(.toc-inline) #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) {
			margin: 0 4em;
		}
	}

/******************************************************************************/
/*                                Sectioning                                  */
/******************************************************************************/

/** Headings ******************************************************************/

	h1, h2, h3, h4, h5, h6, dt {
		page-break-after: avoid;
		page-break-inside: avoid;
		font: 100% sans-serif;   /* Reset all font styling to clear out UA styles */
		font-family: inherit;	/* Inherit the font family. */
		line-height: 1.2;		/* Keep wrapped headings compact */
		hyphens: manual;		/* Hyphenated headings look weird */
	}

	h2, h3, h4, h5, h6 {
		margin-top: 3rem;
	}

	h1, h2, h3 {
		color: #005A9C;
		color: var(--heading-text);
	}

	h1 { font-size: 170%; }
	h2 { font-size: 140%; }
	h3 { font-size: 120%; }
	h4 { font-weight: bold; }
	h5 { font-style: italic; }
	h6 { font-variant: small-caps; }
	dt { font-weight: bold; }

/** Subheadings ***************************************************************/

	h1 + h2,
	#subtitle {
		/* #subtitle is a subtitle in an H2 under the H1 */
		margin-top: 0;
	}
	h2 + h3,
	h3 + h4,
	h4 + h5,
	h5 + h6 {
		margin-top: 1.2em; /* = 1 x line-height */
	}

/** Section divider ***********************************************************/

	:not(.head) > :not(.head) + hr {
		font-size: 1.5em;
		text-align: center;
		margin: 1em auto;
		height: auto;
		color: black;
		color: var(--hr-text);
		border: transparent solid 0;
		background: transparent;
	}
	:not(.head) > hr::before {
		content: "\2727\2003\2003\2727\2003\2003\2727";
	}

/******************************************************************************/
/*                            Paragraphs and Lists                            */
/******************************************************************************/

	p {
		margin: 1em 0;
	}

	dd > p:first-child,
	li > p:first-child {
		margin-top: 0;
	}

	ul, ol {
		margin-left: 0;
		padding-left: 2em;
	}

	li {
		margin: 0.25em 0 0.5em;
		padding: 0;
	}

	dl dd {
		margin: 0 0 .5em 2em;
	}

	.head dd + dd { /* compact for header */
		margin-top: -.5em;
	}

	/* Style for algorithms */
	ol.algorithm ol:not(.algorithm),
	.algorithm > ol ol:not(.algorithm) {
	border-left: 0.5em solid #DEF;
	border-left: 0.5em solid var(--algo-border);
	}

	/* Put nice boxes around each algorithm. */
	[data-algorithm]:not(.heading) {
	 padding: .5em;
	 border: thin solid #ddd;
	 border: thin solid var(--algo-border);
	 border-radius: .5em;
	 margin: .5em calc(-0.5em - 1px);
	}
	[data-algorithm]:not(.heading) > :first-child {
	 margin-top: 0;
	}
	[data-algorithm]:not(.heading) > :last-child {
	 margin-bottom: 0;
	}

	/* Style for switch/case <dl>s */
	dl.switch > dd > ol.only,
	dl.switch > dd > .only > ol {
	margin-left: 0;
	}
	dl.switch > dd > ol.algorithm,
	dl.switch > dd > .algorithm > ol {
	margin-left: -2em;
	}
	dl.switch {
	padding-left: 2em;
	}
	dl.switch > dt {
	text-indent: -1.5em;
	margin-top: 1em;
	}
	dl.switch > dt + dt {
	margin-top: 0;
	}
	dl.switch > dt::before {
	content: '\21AA';
	padding: 0 0.5em 0 0;
	display: inline-block;
	width: 1em;
	text-align: right;
	line-height: 0.5em;
	}

/** Terminology Markup ********************************************************/


/******************************************************************************/
/*                                 Inline Markup                              */
/******************************************************************************/

/** Terminology Markup ********************************************************/
	dfn   { /* Defining instance */
		font-weight: bolder;
	}
	a > i { /* Instance of term */
		font-style: normal;
	}
	dt dfn code, code.idl {
		font-size: inherit;
	}
	dfn var {
		font-style: normal;
	}

/** Change Marking ************************************************************/

	del {
		color: #aa0000;
		color: var(--del-text);
		background: transparent;
		background: var(--del-bg);
		text-decoration: line-through;
	}
	ins {
		color: #006100;
		color: var(--ins-text);
		background: transparent;
		background: var(--ins-bg);
		text-decoration: underline;
	}

	/* for amendments (candidate/proposed changes) */

	.amendment ins, .correction ins, .addition ins,
	ins[class^=c] {
		text-decoration-style: dotted;
	}
	.amendment del, .correction del, .addition del,
	del[class^=c] {
		text-decoration-style: dotted;
	}
	.amendment.proposed ins, .correction.proposed ins, .addition.proposed ins,
	ins[class^=c].proposed {
		text-decoration-style: double;
	}
	.amendment.proposed del, .correction.proposed del, .addition.proposed del,
	del[class^=c].proposed {
		text-decoration-style: double;
	}

/** Miscellaneous improvements to inline formatting ***************************/

	sup {
		vertical-align: super;
		font-size: 80%
	}

/******************************************************************************/
/*                                    Code                                    */
/******************************************************************************/

/** General monospace/pre rules ***********************************************/

	pre, code, samp {
		font-family: Menlo, Consolas, "DejaVu Sans Mono", Monaco, monospace;
		font-size: .9em;
		hyphens: none;
		text-transform: none;
		text-align: left;
		text-align: start;
		font-variant: normal;
		orphans: 3;
		widows: 3;
		page-break-before: avoid;
	}
	pre code,
	code code {
		font-size: 100%;
	}

	pre {
		margin-top: 1em;
		margin-bottom: 1em;
		overflow: auto;
	}

/** Inline Code fragments *****************************************************/

	/* Do something nice. */

/******************************************************************************/
/*                                    Links                                   */
/******************************************************************************/

/** General Hyperlinks ********************************************************/

	/* We hyperlink a lot, so make it less intrusive */
	a[href] {
		color: #034575;
		color: var(--a-normal-text);
		text-decoration: none;
		border-bottom: 1px solid #707070;
		border-bottom: 1px solid var(--a-normal-underline);
		/* Need a bit of extending for it to look okay */
		padding: 0 1px 0;
		margin: 0 -1px 0;
	}
	a:visited {
		color: #034575;
		color: var(--a-visited-text);
		border-bottom-color: #bbb;
		border-bottom-color: var(--a-visited-underline);
	}

	/* Use distinguishing colors when user is interacting with the link */
	a[href]:focus,
	a[href]:hover {
		background: #f8f8f8;
		background: rgba(75%, 75%, 75%, .25);
		background: var(--a-hover-bg);
		border-bottom-width: 3px;
		margin-bottom: -2px;
	}
	a[href]:active {
		color: #c00;
		color: var(--a-active-text);
		border-color: #c00;
		border-color: var(--a-active-underline);
	}

	/* Backout above styling for W3C logo */
	.head .logo,
	.head .logo a {
		border: none;
		text-decoration: none;
		background: transparent;
	}

/******************************************************************************/
/*                                    Images                                  */
/******************************************************************************/

	img {
		border-style: none;
	}

	img, svg {
		/* Intentionally not color-scheme aware. */
		background: white;
	}

	/* For autogen numbers, add
	  .caption::before, figcaption::before { content: "Figure " counter(figure) ". "; }
	*/

	figure, .figure, .sidefigure {
		page-break-inside: avoid;
		text-align: center;
		margin: 2.5em 0;
	}
	.figure img,	.sidefigure img,	figure img,
	.figure object, .sidefigure object, figure object {
		max-width: 100%;
		margin: auto;
		height: auto;
	}
	.figure pre, .sidefigure pre, figure pre {
		text-align: left;
		display: table;
		margin: 1em auto;
	}
	.figure table, figure table {
		margin: auto;
	}
	@media screen and (min-width: 20em) {
		.sidefigure {
			float: right;
			width: 50%;
			margin: 0 0 0.5em 0.5em;
		}
	}
	.caption, figcaption, caption {
		font-style: italic;
		font-size: 90%;
	}
	.caption::before, figcaption::before, figcaption > .marker {
		font-weight: bold;
	}
	.caption, figcaption {
		counter-increment: figure;
	}

	/* DL list is indented 2em, but figure inside it is not */
	dd > .figure, dd > figure { margin-left: -2em; }

/******************************************************************************/
/*                             Colored Boxes                                  */
/******************************************************************************/

	.issue, .note, .example, .assertion, .advisement, blockquote,
	.amendment, .correction, .addition {
		margin: 1em auto;
		padding: .5em;
		border: .5em;
		border-left-style: solid;
		page-break-inside: avoid;
	}
	span.issue, span.note {
		padding: .1em .5em .15em;
		border-right-style: solid;
	}

	blockquote > :first-child,
	.note  > p:first-child,
	.issue > p:first-child,
	.amendment > p:first-child,
	.correction > p:first-child,
	.addition > p:first-child {
		margin-top: 0;
	}
	blockquote > :last-child,
	.note  > p:last-child,
	.issue > p:last-child,
	.amendment > p:last-child,
	.correction > p:last-child,
	.addition > p:last-child {
		margin-bottom: 0;
	}


	.issue::before, .issue > .marker,
	.example::before, .example > .marker,
	.note::before, .note > .marker,
	details.note > summary > .marker,
	.amendment::before, .amendment > .marker,
	details.amendment > summary > .marker,
	.addition::before, .addition > .marker,
	addition.amendment > summary > .marker,
	.correction::before, .correction > .marker,
	correction.amendment > summary > .marker
	{
		text-transform: uppercase;
		padding-right: 1em;
	}

	.example::before, .example > .marker {
		display: block;
		padding-right: 0em;
	}

/** Blockquotes ***************************************************************/

	blockquote {
		border-color: silver;
		border-color: var(--blockquote-border);
		background: transparent;
		background: var(--blockquote-bg);
		color: currentcolor;
		color: var(--blockquote-text);
	}

/** Open issue ****************************************************************/

	.issue {
		border-color: #e05252;
		border-color: var(--issue-border);
		background: #fbe9e9;
		background: var(--issue-bg);
		color: black;
		color: var(--issue-text);
		counter-increment: issue;
		overflow: auto;
	}
	.issue::before, .issue > .marker {
		color: #831616;
		color: var(--issueheading-text);
	}
	/* Add .issue::before { content: "Issue " counter(issue) " "; } for autogen numbers,
	  or use class="marker" to mark up the issue number in source. */

/** Example *******************************************************************/

	.example {
		border-color: #e0cb52;
		border-color: var(--example-border);
		background: #fcfaee;
		background: var(--example-bg);
		color: black;
		color: var(--example-text);
		counter-increment: example;
		overflow: auto;
		clear: both;
	}
	.example::before, .example > .marker {
		color: #574b0f;
		color: var(--exampleheading-text);
	}
	/* Add .example::before { content: "Example " counter(example) " "; } for autogen numbers,
	  or use class="marker" to mark up the example number in source. */

/** Non-normative Note ********************************************************/

	.note {
		border-color: #52e052;
		border-color: var(--note-border);
		background: #e9fbe9;
		background: var(--note-bg);
		color: black;
		color: var(--note-text);
		overflow: auto;
	}

	.note::before, .note > .marker,
	details.note > summary {
		color: hsl(120, 70%, 30%);
		color: var(--noteheading-text);
	}
	/* Add .note::before { content: "Note "; } for autogen label,
	  or use class="marker" to mark up the label in source. */

	details.note[open] > summary {
		border-bottom: 1px silver solid;
		border-bottom: 1px var(--notesummary-underline) solid;
	}

/** Assertion Box *************************************************************/
	/*  for assertions in algorithms */

	.assertion {
		border-color: #AAA;
		border-color: var(--assertion-border);
		background: #EEE;
		background: var(--assertion-bg);
		color: black;
		color: var(--assertion-text);
	}

/** Advisement Box ************************************************************/
	/*  for attention-grabbing normative statements */

	.advisement {
		border-color: orange;
		border-color: var(--advisement-border);
		border-style: none solid;
		background: #fec;
		background: var(--advisement-bg);
		color: black;
		color: var(--advisement-text);
	}
	strong.advisement {
		display: block;
		text-align: center;
	}
	.advisement::before, .advisement > .marker {
		color: #b35f00;
		color: var(--advisementheading-text);
	}

/** Amendment Box *************************************************************/

	.amendment, .correction, .addition {
		border-color: #330099;
		border-color: var(--amendment-border);
		background: #F5F0FF;
		background: var(--amendment-bg);
		color: black;
		color: var(--amendment-text);
	}
	.amendment.proposed, .correction.proposed, .addition.proposed {
		border-style: solid;
		border-block-width: 0.25em;
	}
	.amendment::before, .amendment > .marker,
	details.amendment > summary::before, details.amendment > summary > .marker,
	.correction::before, .correction > .marker,
	details.correction > summary::before, details.correction > summary > .marker,
	.addition::before, .addition > .marker,
	details.addition > summary::before, details.addition > summary > .marker {
		color: #220066;
		color: var(--amendmentheading-text);
	}
	.amendment.proposed::before, .amendment.proposed > .marker,
	details.amendment.proposed > summary::before, details.amendment.proposed > summary > .marker,
	.correction.proposed::before, .correction.proposed > .marker,
	details.correction.proposed > summary::before, details.correction.proposed > summary > .marker,
	.addition.proposed::before, .addition.proposed > .marker,
	details.addition.proposed > summary::before, details.addition.proposed > summary > .marker {
		font-weight: bold;
	}

/** Spec Obsoletion Notice ****************************************************/
	/* obnoxious obsoletion notice for older/abandoned specs. */

	details {
		display: block;
	}
	summary {
		font-weight: bolder;
	}

	.annoying-warning:not(details),
	details.annoying-warning:not([open]) > summary,
	details.annoying-warning[open] {
		background: hsla(40,100%,50%,0.95);
		background: var(--warning-bg);
		color: black;
		color: var(--warning-text);
		padding: .75em 1em;
		border: red;
		border: var(--warning-border);
		border-style: solid none;
		box-shadow: 0 2px 8px black;
		text-align: center;
	}
	.annoying-warning :last-child {
		margin-bottom: 0;
	}

@media not print {
	details.annoying-warning[open] {
		position: fixed;
		left: 0;
		right: 0;
		bottom: 2em;
		z-index: 1000;
	}
}

	details.annoying-warning:not([open]) > summary {
		text-align: center;
	}

/** Entity Definition Boxes ***************************************************/

	.def {
		padding: .5em 1em;
		background: #def;
		background: var(--def-bg);
		margin: 1.2em 0;
		border-left: 0.5em solid #8ccbf2;
		border-left: 0.5em solid var(--def-border);
		color: black;
		color: var(--def-text);
	}

/******************************************************************************/
/*                                    Tables                                  */
/******************************************************************************/

	th, td {
		text-align: left;
		text-align: start;
	}

/** Property/Descriptor Definition Tables *************************************/

	table.def {
		/* inherits .def box styling, see above */
		width: 100%;
		border-spacing: 0;
	}

	table.def td,
	table.def th {
		padding: 0.5em;
		vertical-align: baseline;
		border-bottom: 1px solid #bbd7e9;
		border-bottom: 1px solid var(--defrow-border);
	}

	table.def > tbody > tr:last-child th,
	table.def > tbody > tr:last-child td {
		border-bottom: 0;
	}

	table.def th {
		font-style: italic;
		font-weight: normal;
		padding-left: 1em;
		width: 3em;
	}

	/* For when values are extra-complex and need formatting for readability */
	table td.pre {
		white-space: pre-wrap;
	}

	/* A footnote at the bottom of a def table */
	table.def td.footnote {
		padding-top: 0.6em;
	}
	table.def td.footnote::before {
		content: " ";
		display: block;
		height: 0.6em;
		width: 4em;
		border-top: thin solid;
	}

/** Data tables (and properly marked-up index tables) *************************/
	/*
		<table class="data"> highlights structural relationships in a table
		when correct markup is used (e.g. thead/tbody, th vs. td, scope attribute)

		Use class="complex data" for particularly complicated tables --
		(This will draw more lines: busier, but clearer.)

		Use class="long" on table cells with paragraph-like contents
		(This will adjust text alignment accordingly.)
		Alternately use class="longlastcol" on tables, to have the last column assume "long".
	*/

	table {
		word-wrap: normal;
		overflow-wrap: normal;
		hyphens: manual;
	}

	table.data,
	table.index {
		margin: 1em auto;
		border-collapse: collapse;
		border: hidden;
		width: 100%;
	}
	table.data caption,
	table.index caption {
		max-width: 50em;
		margin: 0 auto 1em;
	}

	table.data td,  table.data th,
	table.index td, table.index th {
		padding: 0.5em 1em;
		border-width: 1px;
		border-color: silver;
		border-color: var(--datacell-border);
		border-top-style: solid;
	}

	table.data thead td:empty {
		padding: 0;
		border: 0;
	}

	table.data  thead,
	table.index thead,
	table.data  tbody,
	table.index tbody {
		border-bottom: 2px solid;
	}

	table.data colgroup,
	table.index colgroup {
		border-left: 2px solid;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		border-right: 2px solid;
		border-top: 1px solid silver;
		border-top: 1px solid var(--datacell-border);
		padding-right: 1em;
	}

	table.data th[colspan],
	table.data td[colspan] {
		text-align: center;
	}

	table.complex.data th,
	table.complex.data td {
		border: 1px solid silver;
		border: 1px solid var(--datacell-border);
		text-align: center;
	}

	table.data.longlastcol td:last-child,
	table.data td.long {
		vertical-align: baseline;
		text-align: left;
	}

	table.data img {
		vertical-align: middle;
	}


/*
Alternate table alignment rules

	table.data,
	table.index {
		text-align: center;
	}

	table.data  thead th[scope="row"],
	table.index thead th[scope="row"] {
		text-align: right;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		text-align: right;
	}

Possible extra rowspan handling

	table.data  tbody th[rowspan]:not([rowspan='1']),
	table.index tbody th[rowspan]:not([rowspan='1']),
	table.data  tbody td[rowspan]:not([rowspan='1']),
	table.index tbody td[rowspan]:not([rowspan='1']) {
		border-left: 1px solid silver;
	}

	table.data  tbody th[rowspan]:first-child,
	table.index tbody th[rowspan]:first-child,
	table.data  tbody td[rowspan]:first-child,
	table.index tbody td[rowspan]:first-child{
		border-left: 0;
		border-right: 1px solid silver;
	}
*/

/******************************************************************************/
/*                                  Indices                                   */
/******************************************************************************/


/** Table of Contents *********************************************************/

	.toc a {
		/* More spacing; use padding to make it part of the click target. */
		padding-top: 0.1rem;
		/* Larger, more consistently-sized click target */
		display: block;
		/* Reverse color scheme */
		color: black;
		color: var(--toclink-text);
		border-color: #3980b5;
		border-color: var(--toclink-underline);
	}
	.toc a:visited {
		color: black;
		color: var(--toclink-visited-text);
		border-color: #054572;
		border-color: var(--toclink-visited-underline);
	}
	.toc a:not(:focus):not(:hover) {
		/* Allow colors to cascade through from link styling */
		border-bottom-color: transparent;
	}

	.toc, .toc ol, .toc ul, .toc li {
		list-style: none; /* Numbers must be inlined into source */
		/* because generated content isn't search/selectable and markers can't do multilevel yet */
		margin:  0;
		padding: 0;
	}
	.toc {
		line-height: 1.1em;
	}

	/* ToC not indented until third level, but font style & margins show hierarchy */
	.toc > li			{ font-weight: bold;   }
	.toc > li li		 { font-weight: normal; }
	.toc > li li li	  { font-size:   95%;	}
	.toc > li li li li	{ font-size:   90%;	}
	.toc > li li li li li { font-size:   85%;	}

	/* @supports not (display:grid) { */
		.toc > li			{ margin: 1.5rem 0;	}
		.toc > li li		 { margin: 0.3rem 0;	}
		.toc > li li li	  { margin-left: 2rem;   }

		/* Section numbers in a column of their own */
		.toc .secno {
			float: left;
			width: 4rem;
			white-space: nowrap;
		}
		.toc > li li li li .secno { font-size: 85%; }
		.toc > li li li li li .secno { font-size: 100%; }

		.toc li {
			clear: both;
		}

		:not(li) > .toc			 { margin-left:  5rem; }
		.toc .secno				 { margin-left: -5rem; }
		.toc > li li li .secno	  { margin-left: -7rem; }
		.toc > li li li li .secno	{ margin-left: -9rem; }
		.toc > li li li li li .secno { margin-left: -11rem; }

		/* Tighten up indentation in narrow ToCs */
		@media (max-width: 30em) {
			:not(li) > .toc			 { margin-left:  4rem; }
			.toc .secno				 { margin-left: -4rem; }
			.toc > li li li			 { margin-left:  1rem; }
			.toc > li li li .secno	  { margin-left: -5rem; }
			.toc > li li li li .secno	{ margin-left: -6rem; }
			.toc > li li li li li .secno { margin-left: -7rem; }
		}
		/* Loosen it on wide screens */
		@media screen and (min-width: 78em) {
			body:not(.toc-inline) :not(li) > .toc			 { margin-left:  4rem; }
			body:not(.toc-inline) .toc .secno				 { margin-left: -4rem; }
			body:not(.toc-inline) .toc > li li li			 { margin-left:  1rem; }
			body:not(.toc-inline) .toc > li li li .secno	  { margin-left: -5rem; }
			body:not(.toc-inline) .toc > li li li li .secno	{ margin-left: -6rem; }
			body:not(.toc-inline) .toc > li li li li li .secno { margin-left: -7rem; }
	}
	/* } */

	@supports (display:grid) and (display:contents) {
		/* Use #toc over .toc to override non-@supports rules. */
		#toc {
			display: grid;
			align-content: start;
			grid-template-columns: auto 1fr;
			grid-column-gap: 1rem;
			column-gap: 1rem;
			grid-row-gap: .6rem;
			row-gap: .6rem;
		}
		#toc h2 {
			grid-column: 1 / -1;
			margin-bottom: 0;
		}
		#toc ol,
		#toc li,
		#toc a {
			display: contents;
			/* Switch <a> to subgrid when supported */
		}
		#toc span {
			margin: 0;
		}
		#toc > .toc > li > a > span {
			/* The spans of the top-level list,
			  comprising the first items of each top-level section. */
			margin-top: 1.1rem;
		}
		#toc#toc .secno { /* Ugh, need more specificity to override base.css */
			grid-column: 1;
			width: auto;
			margin-left: 0;
		}
		#toc .content {
			grid-column: 2;
			width: auto;
			margin-right: 1rem;
		}
		#toc .content:hover,
		#toc .content:focus {
			background: rgba(75%, 75%, 75%, .25);
			background: var(--a-hover-bg);
			border-bottom: 3px solid #054572;
			border-bottom: 3px solid var(--toclink-underline);
			margin-bottom: -3px;
		}
		#toc li li li .content {
			margin-left: 1rem;
		}
		#toc li li li li .content {
			margin-left: 2rem;
		}
	}


/** Index *********************************************************************/

	/* Index Lists: Layout */
	ul.index	  { margin-left: 0; columns: 15em; text-indent: 1em hanging; }
	ul.index li	{ margin-left: 0; list-style: none; break-inside: avoid; }
	ul.index li li { margin-left: 1em; }
	ul.index dl	{ margin-top: 0; }
	ul.index dt	{ margin: .2em 0 .2em 20px;}
	ul.index dd	{ margin: .2em 0 .2em 40px;}
	/* Index Lists: Typography */
	ul.index ul,
	ul.index dl { font-size: smaller; }
	@media not print {
		ul.index li span:not(.dfn-paneled) {
			white-space: nowrap;
			color: transparent; }
		ul.index li a:hover + span,
		ul.index li a:focus + span {
			color: #707070;
			color: var(--indexinfo-text);
		}
	}

/** Index Tables *****************************************************/
	/* See also the data table styling section, which this effectively subclasses */

	table.index {
		font-size: small;
		border-collapse: collapse;
		border-spacing: 0;
		text-align: left;
		margin: 1em 0;
	}

	table.index td,
	table.index th {
		padding: 0.4em;
	}

	table.index tr:hover td:not([rowspan]),
	table.index tr:hover th:not([rowspan]) {
		color: black;
		color: var(--indextable-hover-text);
		background: #f7f8f9;
		background: var(--indextable-hover-bg);
	}

	/* The link in the first column in the property table (formerly a TD) */
	table.index th:first-child a {
		font-weight: bold;
	}

/** Outdated warning **********************************************************/

.outdated-spec {
	color: black;
	color: var(--outdatedspec-text);
	background-color: rgba(0,0,0,0.5);
	background-color: var(--outdatedspec-bg);
}

.outdated-warning {
	position: fixed;
	bottom: 50%;
	left: 0;
	right: 0;
	margin: 0 auto;
	width: 50%;
	background: maroon;
	background: var(--outdated-bg);
	color: white;
	color: var(--outdated-text);
	border-radius: 1em;
	box-shadow: 0 0 1em red;
	box-shadow: 0 0 1em var(--outdated-shadow);
	padding: 2em;
	text-align: center;
	z-index: 2;
}

.outdated-warning a {
	color: currentcolor;
	background: transparent;
}

.edited-rec-warning {
	background: darkorange;
	background: var(--editedrec-bg);
	box-shadow: 0 0 1em;
}

.outdated-warning button {
	color: var(--outdated-text);
	border-radius: 1em;
	box-shadow: 0 0 1em red;
	box-shadow: 0 0 1em var(--outdated-shadow);
	padding: 2em;
	text-align: center;
	z-index: 2;
}

.outdated-warning a {
	color: currentcolor;
	background: transparent;
}

.edited-rec-warning {
	background: darkorange;
	background: var(--editedrec-bg);
	box-shadow: 0 0 1em;
}

.outdated-warning button {
	position: absolute;
	top: 0;
	right:0;
	margin: 0;
	border: 0;
	padding: 0.25em 0.5em;
	background: transparent;
	color: white;
	color: var(--outdated-text);
	font:1em sans-serif;
	text-align:center;
}

.outdated-warning span {
	display: block;
}

.outdated-collapsed {
	bottom: 0;
	border-radius: 0;
	width: 100%;
	padding: 0;
}

/******************************************************************************/
/*                                    Print                                   */
/******************************************************************************/

	@media print {
		/* Pages have their own margins. */
		html {
			margin: 0;
		}
		/* Serif for print. */
		body {
			font-family: serif;
		}

		.outdated-warning {
			position: absolute;
			border-style: solid;
			border-color: red;
		}

		.outdated-warning input {
			display: none;
		}
	}
	@page {
		margin: 1.5cm 1.1cm;
	}



/******************************************************************************/
/*                             Overflow Control                               */
/******************************************************************************/

	.figure .caption, .sidefigure .caption, figcaption {
		/* in case figure is overlarge, limit caption to 50em */
		max-width: 50rem;
		margin-left: auto;
		margin-right: auto;
	}
	.overlarge {
		/* Magic to create good item positioning:
		  "content column" is 50ems wide at max; less on smaller screens.
		  Extra space (after ToC + content) is empty on the right.

		  1. When item < content column, centers item in column.
		  2. When content < item < available, left-aligns.
		  3. When item > available, fills available + scroll bar.
		*/
		display: grid;
		grid-template-columns: minmax(0, 50em);
	}
	.overlarge > table {
		/* limit preferred width of table */
		max-width: 50em;
		margin-left: auto;
		margin-right: auto;
	}

	@media (min-width: 55em) {
		.overlarge {
			margin-right: calc(13px + 26.5rem - 50vw);
			max-width: none;
		}
	}
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) .overlarge {
			/* 30.5em body padding 50em content area */
			margin-right: calc(40em - 50vw) !important;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) .overlarge {
			/* 4em html margin 30.5em body padding 50em content area */
			margin-right: calc(84.5em - 100vw) !important;
		}
	}

	@media not print {
		.overlarge {
			overflow-x: auto;
			/* See Lea Verou's explanation background-attachment:
			* http://lea.verou.me/2012/04/background-attachment-local/
			*
			background: top left  / 4em 100% linear-gradient(to right,  #ffffff, rgba(255, 255, 255, 0)) local,
						top right / 4em 100% linear-gradient(to left, #ffffff, rgba(255, 255, 255, 0)) local,
						top left  / 1em 100% linear-gradient(to right,  #c3c3c5, rgba(195, 195, 197, 0)) scroll,
						top right / 1em 100% linear-gradient(to left, #c3c3c5, rgba(195, 195, 197, 0)) scroll,
						white;
			background-repeat: no-repeat;
			*/
		}
	}
</style>
  <meta content="Bikeshed version 4e8dd937, updated Fri Nov 13 16:49:31 2020 -0800" name="generator">
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-colors */

/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #707070;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #bbb;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-dfn-panel */

:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    height: auto;
    width: -webkit-fit-content;
    width: fit-content;
    max-width: 300px;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0; }
.dfn-panel li { list-style: inside; }
.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled { cursor: pointer; }
</style>
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-selflinks */

:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* style-syntax-highlighting */

            pre.idl.highlight {
                background: var(--borderedblock-bg, var(--def-bg));
            }
            
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */
</style>
<style>/* style-var-click-highlighting */

    var { cursor: pointer; }
    var.selected0 { background-color: #F4D200; box-shadow: 0 0 0 2px #F4D200; }
    var.selected1 { background-color: #FF87A2; box-shadow: 0 0 0 2px #FF87A2; }
    var.selected2 { background-color: #96E885; box-shadow: 0 0 0 2px #96E885; }
    var.selected3 { background-color: #3EEED2; box-shadow: 0 0 0 2px #3EEED2; }
    var.selected4 { background-color: #EACFB6; box-shadow: 0 0 0 2px #EACFB6; }
    var.selected5 { background-color: #82DDFF; box-shadow: 0 0 0 2px #82DDFF; }
    var.selected6 { background-color: #FFBCF2; box-shadow: 0 0 0 2px #FFBCF2; }
    </style>
<style>/* style-darkmode */

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}

@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
    }
}
@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"></p>
   <h1 class="p-name no-ref" id="title">Prerendering Revamped</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">A Collection of Interesting Ideas, <time class="dt-updated" datetime="2021-02-18">18 February 2021</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>Issue Tracking:
     <dd><a href="https://github.com/jeremyroman/alternate-loading-modes/issues/">GitHub</a>
     <dd><a href="#issues-index">Inline In Spec</a>
     <dt class="editor">Editors:
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:d@domenic.me">Domenic Denicola</a> (<a class="p-org org" href="https://www.google.com/">Google</a>)
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:domfarolino@gmail.com">Dominic Farolino</a> (<a class="p-org org" href="https://www.google.com/">Google</a>)
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="http://creativecommons.org/publicdomain/zero/1.0/" rel="license"><img alt="CC0" src="https://licensebuttons.net/p/zero/1.0/80x15.png"></a> To the extent possible under law, the editors have waived all copyright
and related or neighboring rights to this work.
In addition, as of 18 February 2021,
the editors have made this specification available under the <a href="http://www.openwebfoundation.org/legal/the-owf-1-0-agreements/owfa-1-0" rel="license">Open Web Foundation Agreement Version 1.0</a>,
which is available at http://www.openwebfoundation.org/legal/the-owf-1-0-agreements/owfa-1-0.
Parts of this work may be from another specification document.  If so, those parts are instead covered by the license of that specification document. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This document contains a collection of specification patches for well-specified prerendering.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#link-rel-prerender"><span class="secno">1</span> <span class="content">Link type "<span><code>prerender</code></span>"</span></a>
    <li>
     <a href="#speculation-rules"><span class="secno">2</span> <span class="content">Speculation rules</span></a>
     <ol class="toc">
      <li><a href="#speculation-rules-dfns"><span class="secno">2.1</span> <span class="content">Definitions</span></a>
      <li><a href="#speculation-rules-script"><span class="secno">2.2</span> <span class="content">The <code><span>script</span></code> element</span></a>
      <li><a href="#speculation-rules-prepare-a-script-patch"><span class="secno">2.3</span> <span class="content">Prepare a script</span></a>
      <li><a href="#speculation-rules-parsing"><span class="secno">2.4</span> <span class="content">Parsing</span></a>
      <li><a href="#speculation-rules-processing"><span class="secno">2.5</span> <span class="content">Processing model</span></a>
     </ol>
    <li><a href="#prerendering-bcs"><span class="secno">3</span> <span class="content">Prerendering browsing contexts</span></a>
    <li>
     <a href="#navigation"><span class="secno">4</span> <span class="content">Navigation and session history</span></a>
     <ol class="toc">
      <li><a href="#navigate-activation"><span class="secno">4.1</span> <span class="content">Allowing activation in place of navigation</span></a>
      <li><a href="#redirect-handling"><span class="secno">4.2</span> <span class="content">Redirect handling</span></a>
      <li><a href="#always-replacement"><span class="secno">4.3</span> <span class="content">Maintaining a trivial session history</span></a>
      <li><a href="#no-bad-navs"><span class="secno">4.4</span> <span class="content">Preventing non-HTTP(S) navigations</span></a>
      <li><a href="#cleanup-upon-discarding"><span class="secno">4.5</span> <span class="content">Cleanup upon discarding a <code class="idl"><span>Document</span></code></span></a>
     </ol>
    <li>
     <a href="#nonsense-behaviors"><span class="secno">5</span> <span class="content">Preventing nonsensical behaviors</span></a>
     <ol class="toc">
      <li><a href="#patch-window-apis"><span class="secno">5.1</span> <span class="content">APIs for creating and navigating browsing contexts by name</span></a>
     </ol>
    <li>
     <a href="#intrusive-behaviors"><span class="secno">6</span> <span class="content">Preventing intrusive behaviors</span></a>
     <ol class="toc">
      <li><a href="#patch-downloading"><span class="secno">6.1</span> <span class="content">Downloading resources</span></a>
      <li><a href="#patch-modals"><span class="secno">6.2</span> <span class="content">User prompts</span></a>
      <li>
       <a href="#permissions"><span class="secno">6.3</span> <span class="content">Waiting before permissions checks</span></a>
       <ol class="toc">
        <li><a href="#patch-geolocation"><span class="secno">6.3.1</span> <span class="content">Geolocation API</span></a>
        <li><a href="#patch-serial"><span class="secno">6.3.2</span> <span class="content">Web Serial API</span></a>
        <li><a href="#patch-notifications"><span class="secno">6.3.3</span> <span class="content">Notifications API</span></a>
        <li><a href="#patch-midi"><span class="secno">6.3.4</span> <span class="content">Web MIDI API</span></a>
        <li><a href="#patch-idle-detection"><span class="secno">6.3.5</span> <span class="content">Idle Detection API</span></a>
        <li><a href="#activation-gated"><span class="secno">6.3.6</span> <span class="content">Activation-gated APIs</span></a>
       </ol>
     </ol>
    <li><a href="#todo"><span class="secno">7</span> <span class="content">TODO</span></a>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="link-rel-prerender"><span class="secno">1. </span><span class="content">Link type "<dfn class="dfn-paneled" data-dfn-for="link/rel" data-dfn-type="attr-value" data-export id="attr-valuedef-link-rel-prerender"><code>prerender</code></dfn>"</span><a class="self-link" href="#link-rel-prerender"></a></h2>
   <p><em>The following section would be added as a new sub-section of <a data-link-type="biblio" href="#biblio-html">[HTML]</a>'s <a href="https://html.spec.whatwg.org/multipage/links.html#linkTypes">Link types</a> section. This should replace the prerender documentation in <a data-link-type="biblio" href="#biblio-resource-hints">[RESOURCE-HINTS]</a></em></p>
   <p>The <code><a data-link-type="attr-value" href="#attr-valuedef-link-rel-prerender" id="ref-for-attr-valuedef-link-rel-prerender">prerender</a></code> keyword may be used with <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/semantics.html#the-link-element" id="ref-for-the-link-element">link</a></code> elements. This keyword creates an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/links.html#external-resource-link" id="ref-for-external-resource-link">external resource link</a>. This keyword is <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/links.html#body-ok" id="ref-for-body-ok">body-ok</a>.</p>
   <p>The appropriate times to <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/semantics.html#fetch-and-process-the-linked-resource" id="ref-for-fetch-and-process-the-linked-resource">fetch and process the linked resource</a> for such a link are:</p>
   <ul>
    <li>When the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/links.html#external-resource-link" id="ref-for-external-resource-link①">external resource link</a> is created on a <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/semantics.html#the-link-element" id="ref-for-the-link-element①">link</a></code> element that is already <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#browsing-context-connected" id="ref-for-browsing-context-connected">browsing-context connected</a>.
    <li>When the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/links.html#external-resource-link" id="ref-for-external-resource-link②">external resource link</a>’s <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/semantics.html#the-link-element" id="ref-for-the-link-element②">link</a></code> element <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#becomes-browsing-context-connected" id="ref-for-becomes-browsing-context-connected">becomes browsing-context connected</a>.
    <li>When the <code><a data-link-type="element-sub" href="https://html.spec.whatwg.org/multipage/semantics.html#attr-link-href" id="ref-for-attr-link-href">href</a></code> attribute is changed on the <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/semantics.html#the-link-element" id="ref-for-the-link-element③">link</a></code> element of an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/links.html#external-resource-link" id="ref-for-external-resource-link③">external resource link</a> that is already <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#browsing-context-connected" id="ref-for-browsing-context-connected①">browsing-context connected</a>.
    <li>When the <code><a data-link-type="element-sub" href="https://html.spec.whatwg.org/multipage/semantics.html#attr-link-referrerpolicy" id="ref-for-attr-link-referrerpolicy">referrerpolicy</a></code> attribute’s state is changed on the <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/semantics.html#the-link-element" id="ref-for-the-link-element④">link</a></code> element of an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/links.html#external-resource-link" id="ref-for-external-resource-link④">external resource link</a> that is already <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#browsing-context-connected" id="ref-for-browsing-context-connected②">browsing-context connected</a>.
   </ul>
   <div class="algorithm" data-algorithm="prerender-processing-model">
     The <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/semantics.html#fetch-and-process-the-linked-resource" id="ref-for-fetch-and-process-the-linked-resource①">fetch and process the linked resource</a> algorithm for <code><a data-link-type="attr-value" href="#attr-valuedef-link-rel-prerender" id="ref-for-attr-valuedef-link-rel-prerender①">prerender</a></code> links, given a <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/semantics.html#the-link-element" id="ref-for-the-link-element⑤">link</a></code> element <var>el</var>, is as follows: 
    <ol>
     <li data-md>
      <p>If <var>el</var>’s <code><a data-link-type="element-sub" href="https://html.spec.whatwg.org/multipage/semantics.html#attr-link-href" id="ref-for-attr-link-href①">href</a></code> attribute’s value is the empty string, then return.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/urls-and-fetching.html#parse-a-url" id="ref-for-parse-a-url">Parse a URL</a> given <var>el</var>’s <code><a data-link-type="element-sub" href="https://html.spec.whatwg.org/multipage/semantics.html#attr-link-href" id="ref-for-attr-link-href②">href</a></code> attribute, relative to <var>el</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document" id="ref-for-concept-node-document">node document</a>. If that fails, then return. Otherwise, let <var>url</var> be the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/urls-and-fetching.html#resulting-url-record" id="ref-for-resulting-url-record">resulting URL record</a>.</p>
     <li data-md>
      <p>If <var>url</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme" id="ref-for-concept-url-scheme">scheme</a> is not an <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#http-scheme" id="ref-for-http-scheme">HTTP(S) scheme</a>, then return.</p>
     <li data-md>
      <p>Let <var>referrerPolicy</var> be  the current state of <var>el</var>’s <code><a data-link-type="element-sub" href="https://html.spec.whatwg.org/multipage/semantics.html#attr-link-referrerpolicy" id="ref-for-attr-link-referrerpolicy①">referrerpolicy</a></code> attribute.</p>
     <li data-md>
      <p>If <var>url</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin">origin</a> is not <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#same-origin" id="ref-for-same-origin">same origin</a> with <var>el</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document" id="ref-for-concept-node-document①">node document</a>'s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-origin" id="ref-for-concept-document-origin">origin</a>, then:</p>
      <ol>
       <li data-md>
        <p>If the <a data-link-type="dfn" href="#list-of-sufficiently-strict-speculative-navigation-referrer-policies" id="ref-for-list-of-sufficiently-strict-speculative-navigation-referrer-policies">list of sufficiently-strict speculative navigation referrer policies</a> does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain">contain</a> <var>referrerPolicy</var>, then return.</p>
      </ol>
     <li data-md>
      <p><a data-link-type="dfn" href="#create-a-prerendering-browsing-context" id="ref-for-create-a-prerendering-browsing-context">Create a prerendering browsing context</a> with <var>url</var>, <var>referrerPolicy</var>, and <var>el</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document" id="ref-for-concept-node-document②">node document</a>.</p>
    </ol>
   </div>
   <p>A user agent must not <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/parsing.html#delay-the-load-event" id="ref-for-delay-the-load-event">delay the load event</a> of the <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/semantics.html#the-link-element" id="ref-for-the-link-element⑥">link</a></code> element’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document" id="ref-for-concept-node-document③">node document</a> for this link type.</p>
   <p class="note" role="note">Note that this link type does not fire <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/indices.html#event-error" id="ref-for-event-error">error</a></code> or <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/indices.html#event-load" id="ref-for-event-load">load</a></code> events, unlike many other link types that create <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/links.html#external-resource-link" id="ref-for-external-resource-link⑤">external resource links</a>. </p>
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="list-of-sufficiently-strict-speculative-navigation-referrer-policies">list of sufficiently-strict speculative navigation referrer policies</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list">list</a> containing the following subset of <a data-link-type="dfn" href="https://w3c.github.io/webappsec-referrer-policy/#referrer-policy" id="ref-for-referrer-policy">referrer policies</a>: the empty string, "<code>strict-origin-when-cross-origin</code>", "<code>strict-origin</code>", "<code>same-origin</code>", "<code>no-referrer</code>".</p>
   <h2 class="heading settled" data-level="2" id="speculation-rules"><span class="secno">2. </span><span class="content">Speculation rules</span><a class="self-link" href="#speculation-rules"></a></h2>
   <h3 class="heading settled" data-level="2.1" id="speculation-rules-dfns"><span class="secno">2.1. </span><span class="content">Definitions</span><a class="self-link" href="#speculation-rules-dfns"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="speculation-rule">speculation rule</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct">struct</a> with the following <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct-item" id="ref-for-struct-item">items</a>:</p>
   <ul>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="speculation rule" data-dfn-type="dfn" data-noexport id="speculation-rule-urls">URLs</dfn>, an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set">ordered set</a> of <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url">URLs</a></p>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="speculation rule" data-dfn-type="dfn" data-noexport id="speculation-rule-requirements">requirements</dfn>, an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set①">ordered set</a> of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string">strings</a></p>
   </ul>
   <p>The only valid string for <a data-link-type="dfn" href="#speculation-rule-requirements" id="ref-for-speculation-rule-requirements">requirements</a> to contain is "<code>anonymous-client-ip-when-cross-origin</code>".</p>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="speculation-rule-set">speculation rule set</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct①">struct</a> with the following <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct-item" id="ref-for-struct-item①">items</a>:</p>
   <ul>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="speculation rule set" data-dfn-type="dfn" data-noexport id="speculation-rule-set-prefetch-rules">prefetch rules</dfn>, a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list①">list</a> of <a data-link-type="dfn" href="#speculation-rule" id="ref-for-speculation-rule">speculation rules</a></p>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-for="speculation rule set" data-dfn-type="dfn" data-noexport id="speculation-rule-set-prefetch-with-subresources-rules">prefetch-with-subresources rules</dfn>, a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list②">list</a> of <a data-link-type="dfn" href="#speculation-rule" id="ref-for-speculation-rule①">speculation rules</a></p>
   </ul>
   <h3 class="heading settled" data-level="2.2" id="speculation-rules-script"><span class="secno">2.2. </span><span class="content">The <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/scripting.html#script" id="ref-for-script">script</a></code> element</span><a class="self-link" href="#speculation-rules-script"></a></h3>
   <p><em>Note</em>: This section contains modifications to the corresponding section of <a data-link-type="biblio" href="#biblio-html">[HTML]</a>.</p>
   <p>To process speculation rules consistently with the existing script types, we make the following changes:</p>
   <ul>
    <li data-md>
     <p>Add "<code>speculationrules</code>" to the list of valid values for <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/scripting.html#concept-script-type" id="ref-for-concept-script-type">the script’s type</a>.</p>
    <li data-md>
     <p>Rename <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/scripting.html#concept-script-script" id="ref-for-concept-script-script">the script’s script</a> to <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="the-scripts-result">the script’s result</dfn>, which can be either a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-script" id="ref-for-concept-script">script</a> or a <a data-link-type="dfn" href="#speculation-rule-set" id="ref-for-speculation-rule-set">speculation rule set</a>.</p>
   </ul>
   <p>The following algorithms are updated accordingly:</p>
   <ul>
    <li data-md>
     <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/scripting.html#prepare-a-script" id="ref-for-prepare-a-script">Prepare a script</a>: see <a href="#speculation-rules-prepare-a-script-patch">§ 2.3 Prepare a script</a>.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/scripting.html#execute-the-script-block" id="ref-for-execute-the-script-block">Execute a script block</a>: Add the following case to the switch on <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/scripting.html#concept-script-type" id="ref-for-concept-script-type①">the script’s type</a>:</p>
     <dl>
      <dt>"<code>speculationrules</code>"
      <dd>
       <ol>
        <li data-md>
         <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert">Assert</a>: Never reached.</p>
       </ol>
     </dl>
   </ul>
   <p class="issue" id="issue-c2e21e13"><a class="self-link" href="#issue-c2e21e13"></a>We should consider whether we also want to make this execute even if scripting is disabled.</p>
   <p class="issue" id="issue-bb120c28"><a class="self-link" href="#issue-bb120c28"></a>We should also incorporate the case where a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/scripting.html#dom-script-src" id="ref-for-dom-script-src">src</a></code> attribute is set.</p>
   <p class="issue" id="issue-9cd39e70"><a class="self-link" href="#issue-9cd39e70"></a>We could fire <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/indices.html#event-error" id="ref-for-event-error①">error</a></code> and <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/indices.html#event-load" id="ref-for-event-load①">load</a></code> events if we wanted to.</p>
   <h3 class="heading settled" data-level="2.3" id="speculation-rules-prepare-a-script-patch"><span class="secno">2.3. </span><span class="content">Prepare a script</span><a class="self-link" href="#speculation-rules-prepare-a-script-patch"></a></h3>
   <p>Inside the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/scripting.html#prepare-a-script" id="ref-for-prepare-a-script①">prepare a script</a> algorithm we make the following changes:</p>
   <ul>
    <li data-md>
     <p>Insert the following step as the second-last sub-step under "Determine the script’s type as follows:":</p>
     <ul>
      <li data-md>
       <p>If the script block’s type string is an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-case-insensitive" id="ref-for-ascii-case-insensitive">ASCII case-insensitive</a> match for the string "<code>speculationrules</code>", <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/scripting.html#concept-script-type" id="ref-for-concept-script-type②">the script’s type</a> is "<code>speculationrules</code>".</p>
     </ul>
    <li data-md>
     <p>Insert the following case in the switch on <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/scripting.html#concept-script-type" id="ref-for-concept-script-type③">the script’s type</a> within the step which begins "If the element does not have a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/scripting.html#dom-script-src" id="ref-for-dom-script-src①">src</a></code> content attribute..."</p>
     <dl>
      <dt>"<code>speculationrules</code>"
      <dd>
       <ol>
        <li data-md>
         <p>Let <var>result</var> be the result of <a data-link-type="dfn" href="#parse-speculation-rules" id="ref-for-parse-speculation-rules">parsing speculation rules</a> given source text and base URL.</p>
        <li data-md>
         <p>Set <a data-link-type="dfn" href="#the-scripts-result" id="ref-for-the-scripts-result">the script’s result</a> to <var>result</var>.</p>
        <li data-md>
         <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/scripting.html#the-script-is-ready" id="ref-for-the-script-is-ready">The script is ready</a>.</p>
       </ol>
     </dl>
    <li data-md>
     <p>Insert the following case to the switch in the subsequent step beginning "Then, follow the first of the following options...." after the cases which apply only to "<code>classic</code>" and "<code>module</code>" scripts:</p>
     <dl>
      <dt>If <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/scripting.html#concept-script-type" id="ref-for-concept-script-type④">the script’s type</a> is "<code>speculationrules</code>"
      <dd>
       <ol>
        <li data-md>
         <p>When <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/scripting.html#the-script-is-ready" id="ref-for-the-script-is-ready①">the script is ready</a>, run the following steps:</p>
         <ol>
          <li data-md>
           <p>If <a data-link-type="dfn" href="#the-scripts-result" id="ref-for-the-scripts-result①">the script’s result</a> is not null, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append">append</a> it to the element’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document" id="ref-for-concept-node-document④">node document</a>'s <a data-link-type="dfn" href="#document-list-of-speculation-rule-sets" id="ref-for-document-list-of-speculation-rule-sets">list of speculation rule sets</a>.</p>
         </ol>
       </ol>
     </dl>
   </ul>
   <h3 class="heading settled" data-level="2.4" id="speculation-rules-parsing"><span class="secno">2.4. </span><span class="content">Parsing</span><a class="self-link" href="#speculation-rules-parsing"></a></h3>
   <p class="note" role="note"> The general principle here is to allow the existence of directives which are not understood, but not to accept into the rule set a rule which the user agent does not fully understand.
  This reduces the risk of unintended activity by user agents which are unaware of most recently added directives which might limit the scope of a rule. </p>
   <div class="algorithm" data-algorithm="parse speculation rules">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="parse-speculation-rules">parse speculation rules</dfn> given a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string①">string</a> <var>input</var> and a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url①">URL</a> <var>baseURL</var>, perform the following steps. They return a <a data-link-type="dfn" href="#speculation-rule-set" id="ref-for-speculation-rule-set①">speculation rule set</a> or null. 
    <ol>
     <li data-md>
      <p>Let <var>parsed</var> be the result of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#parse-a-json-string-to-an-infra-value" id="ref-for-parse-a-json-string-to-an-infra-value">parsing a JSON string to an Infra value</a> given <var>input</var>.</p>
     <li data-md>
      <p>If <var>parsed</var> is not a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map">map</a>, then return null.</p>
     <li data-md>
      <p>Let <var>result</var> be an empty <a data-link-type="dfn" href="#speculation-rule-set" id="ref-for-speculation-rule-set②">speculation rule set</a>.</p>
     <li data-md>
      <p>If <var>parsed</var>["<code>prefetch</code>"] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists">exists</a> and is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list③">list</a>, then <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate">for each</a> <var>prefetchRule</var> of <var>parsed</var>["<code>prefetch</code>"]:</p>
      <ol>
       <li data-md>
        <p>If <var>prefetchRule</var> is not a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map①">map</a>, then <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue">continue</a>.</p>
       <li data-md>
        <p>Let <var>rule</var> be the result of <a data-link-type="dfn" href="#parse-a-speculation-rule" id="ref-for-parse-a-speculation-rule">parsing a speculation rule</a> given <var>prefetchRule</var> and <var>baseURL</var>.</p>
       <li data-md>
        <p>If <var>rule</var> is null, then <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue①">continue</a>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append①">Append</a> <var>rule</var> to <var>result</var>’s <a data-link-type="dfn" href="#speculation-rule-set-prefetch-rules" id="ref-for-speculation-rule-set-prefetch-rules">prefetch rules</a>.</p>
      </ol>
     <li data-md>
      <p>If <var>parsed</var>["<code>prefetch_with_subresources</code>"] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists①">exists</a> and is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list④">list</a>, then <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate①">for each</a> <var>pwsRule</var> of <var>parsed</var>["<code>prefetch_with_subresources</code>"]:</p>
      <ol>
       <li data-md>
        <p>If <var>pwsRule</var> is not a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map②">map</a>, then <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue②">continue</a>.</p>
       <li data-md>
        <p>Let <var>rule</var> be the result of <a data-link-type="dfn" href="#parse-a-speculation-rule" id="ref-for-parse-a-speculation-rule①">parsing a speculation rule</a> given <var>pwsRule</var> and <var>baseURL</var>.</p>
       <li data-md>
        <p>If <var>rule</var> is null, then <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue③">continue</a>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append②">Append</a> <var>rule</var> to <var>result</var>’s <a data-link-type="dfn" href="#speculation-rule-set-prefetch-with-subresources-rules" id="ref-for-speculation-rule-set-prefetch-with-subresources-rules">prefetch-with-subresources rules</a>.</p>
      </ol>
     <li data-md>
      <p>Return <var>result</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="parse a speculation rule">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="parse-a-speculation-rule">parse a speculation rule</dfn> given a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map③">map</a> <var>input</var> and a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url②">URL</a> <var>baseURL</var>, perform the following steps. They return a <a data-link-type="dfn" href="#speculation-rule" id="ref-for-speculation-rule②">speculation rule</a> or null. 
    <ol>
     <li data-md>
      <p>If <var>input</var> has any <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-key" id="ref-for-map-key">key</a> other than "<code>source</code>", "<code>urls</code>", and "<code>requires</code>", then return null.</p>
     <li data-md>
      <p>If <var>input</var>["<code>source</code>"] does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists②">exist</a> or is not the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string②">string</a> "<code>list</code>", then return null.</p>
     <li data-md>
      <p>Let <var>urls</var> be an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list⑤">list</a>.</p>
     <li data-md>
      <p>If <var>input</var>["<code>urls</code>"] does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists③">exist</a>, is not a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list⑥">list</a>, or has any element which is not a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string③">string</a>, then return null.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate②">For each</a> <var>urlString</var> of <var>input</var>["<code>urls</code>"]:</p>
      <ol>
       <li data-md>
        <p>Let <var>parsedURL</var> be the result of <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-basic-url-parser" id="ref-for-concept-basic-url-parser">parsing</a> <var>urlString</var> with <var>baseURL</var>.</p>
       <li data-md>
        <p>If <var>parsedURL</var> is failure, then <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue④">continue</a>.</p>
       <li data-md>
        <p>If <var>parsedURL</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme" id="ref-for-concept-url-scheme①">scheme</a> is not an <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#http-scheme" id="ref-for-http-scheme①">HTTP(S) scheme</a>, then <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue⑤">continue</a>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append③">Append</a> <var>parsedURL</var> to <var>urls</var>.</p>
      </ol>
     <li data-md>
      <p>Let <var>requirements</var> be an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set②">ordered set</a>.</p>
     <li data-md>
      <p>If <var>input</var>["<code>requires</code>"] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists④">exists</a>, but is not a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list⑦">list</a>, then return null.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate③">For each</a> <var>requirement</var> of <var>input</var>["<code>requires</code>"]:</p>
      <ol>
       <li data-md>
        <p>If <var>requirement</var> is not the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string④">string</a> "<code>anonymous-client-ip-when-cross-origin</code>", then return null.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append">Append</a> <var>requirement</var> to <var>requirements</var>.</p>
      </ol>
     <li data-md>
      <p>Return a <a data-link-type="dfn" href="#speculation-rule" id="ref-for-speculation-rule③">speculation rule</a> with <a data-link-type="dfn" href="#speculation-rule-urls" id="ref-for-speculation-rule-urls">URLs</a> <var>urls</var> and <a data-link-type="dfn" href="#speculation-rule-requirements" id="ref-for-speculation-rule-requirements①">requirements</a> <var>requirements</var>.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="2.5" id="speculation-rules-processing"><span class="secno">2.5. </span><span class="content">Processing model</span><a class="self-link" href="#speculation-rules-processing"></a></h3>
   <p>A <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document">document</a> has a <dfn class="dfn-paneled" data-dfn-for="document" data-dfn-type="dfn" data-export id="document-list-of-speculation-rule-sets">list of speculation rule sets</dfn>, which is an initially empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list⑧">list</a>.</p>
   <p>Periodically, for any <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document①">document</a> <var>document</var>, the user agent may <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task">queue a global task</a> on the <a class="idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source" id="ref-for-dom-manipulation-task-source">DOM manipulation task source</a> with <var>document</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global">relevant global object</a> to <a data-link-type="dfn" href="#consider-speculation" id="ref-for-consider-speculation">consider speculation</a> for <var>document</var>.</p>
   <p class="note" role="note"> The user agent will likely do this after the insertion of new speculation rules, or when resources are idle and available. </p>
   <div class="algorithm" data-algorithm="consider speculation">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="consider-speculation">consider speculation</dfn> for a <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document②">document</a> <var>document</var>: 
    <ol>
     <li data-md>
      <p>If <var>document</var> is not <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#fully-active" id="ref-for-fully-active">fully active</a>, then return.</p>
      <p class="issue" id="issue-30bcda38"><a class="self-link" href="#issue-30bcda38"></a>It’s likely that we should also handle prerendered and back-forward cached documents. </p>
     <li data-md>
      <p>For each <var>ruleSet</var> of <var>document</var>’s <a data-link-type="dfn" href="#document-list-of-speculation-rule-sets" id="ref-for-document-list-of-speculation-rule-sets①">list of speculation rule sets</a>:</p>
      <ol>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate④">For each</a> <var>rule</var> of <var>ruleSet</var>’s <a data-link-type="dfn" href="#speculation-rule-set-prefetch-with-subresources-rules" id="ref-for-speculation-rule-set-prefetch-with-subresources-rules①">prefetch-with-subresources rules</a>:</p>
        <ol>
         <li data-md>
          <p>Let <var>requiresAnonymousClientIPWhenCrossOrigin</var> be true if <var>rule</var>’s <a data-link-type="dfn" href="#speculation-rule-requirements" id="ref-for-speculation-rule-requirements②">requirements</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain①">contains</a> "<code>anonymous-client-ip-when-cross-origin</code>", and false otherwise.</p>
         <li data-md>
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate⑤">For each</a> <var>url</var> of <var>rule</var>’s <a data-link-type="dfn" href="#speculation-rule-urls" id="ref-for-speculation-rule-urls①">URLs</a>:</p>
          <ol>
           <li data-md>
            <p>The user agent may prefetch <var>url</var> given <var>requiresAnonymousClientIPWhenCrossOrigin</var>, including subresources identified by <a href="https://github.com/whatwg/html/pull/5959">speculative HTML parsing</a>.</p>
            <p class="issue" id="issue-81bee6f0"><a class="self-link" href="#issue-81bee6f0"></a>TODO: expand this along with prefetch more generally. </p>
          </ol>
        </ol>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate⑥">For each</a> <var>rule</var> of <var>ruleSet</var>’s <a data-link-type="dfn" href="#speculation-rule-set-prefetch-rules" id="ref-for-speculation-rule-set-prefetch-rules①">prefetch rules</a>:</p>
        <ol>
         <li data-md>
          <p>Let <var>requiresAnonymousClientIPWhenCrossOrigin</var> be true if <var>rule</var>’s <a data-link-type="dfn" href="#speculation-rule-requirements" id="ref-for-speculation-rule-requirements③">requirements</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain②">contains</a> "<code>anonymous-client-ip-when-cross-origin</code>", and false otherwise.</p>
         <li data-md>
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate⑦">For each</a> <var>url</var> of <var>rule</var>’s <a data-link-type="dfn" href="#speculation-rule-urls" id="ref-for-speculation-rule-urls②">URLs</a>:</p>
          <ol>
           <li data-md>
            <p>The user agent may prefetch <var>url</var> given <var>requiresAnonymousClientIPWhenCrossOrigin</var>.</p>
            <p class="issue" id="issue-8088bc6e"><a class="self-link" href="#issue-8088bc6e"></a>TODO: expand this to actually elaborate on how prefetch works, once initiated, and to incorporate the <var>requiresAnonymousClientIPWhenCrossOrigin</var> flag. We may wish to include language about when the UA should deduplicate requests. </p>
          </ol>
        </ol>
      </ol>
    </ol>
   </div>
   <p class="issue" id="issue-ba67a3f6"><a class="self-link" href="#issue-ba67a3f6"></a> We should also notice removals and consider cancelling speculated actions. </p>
   <h2 class="heading settled" data-level="3" id="prerendering-bcs"><span class="secno">3. </span><span class="content">Prerendering browsing contexts</span><a class="self-link" href="#prerendering-bcs"></a></h2>
   <p><em>The following section would be added as a new sub-section of <a data-link-type="biblio" href="#biblio-html">[HTML]</a>'s <a href="https://html.spec.whatwg.org/multipage/browsers.html#windows">Browsing contexts</a> section.</em></p>
   <p>Every <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context" id="ref-for-browsing-context">browsing context</a> has a <dfn class="dfn-paneled" data-dfn-for="browsing context" data-dfn-type="dfn" data-noexport id="browsing-context-loading-mode">loading mode</dfn>, which is one of the following:</p>
   <dl>
    <dt data-md>"<code>default</code>"
    <dd data-md>
     <p>No special considerations are applied to content loaded in this browsing context</p>
    <dt data-md>"<code>prerender</code>"
    <dd data-md>
     <p>This browsing context is displaying prerendered content</p>
    <dt data-md>"<code>uncredentialed-prerender</code>"
    <dd data-md>
     <p>This browsing context is displaying prerendered content, and furthermore that content cannot make credentialed fetches</p>
   </dl>
   <p>By default, a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context" id="ref-for-browsing-context①">browsing context</a>'s <a data-link-type="dfn" href="#browsing-context-loading-mode" id="ref-for-browsing-context-loading-mode">loading mode</a> is "<code>default</code>". A browsing context whose <a data-link-type="dfn" href="#browsing-context-loading-mode" id="ref-for-browsing-context-loading-mode①">loading mode</a> is either "<code>prerender</code>" or "<code>uncredentialed-prerender</code>" is known as a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="prerendering-browsing-context">prerendering browsing context</dfn>.</p>
   <p class="note" role="note">This specification enforces that <a data-link-type="dfn" href="#prerendering-browsing-context" id="ref-for-prerendering-browsing-context">prerendering browsing contexts</a> are always <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#top-level-browsing-context" id="ref-for-top-level-browsing-context">top-level browsing contexts</a>, i.e., that a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context" id="ref-for-nested-browsing-context">nested browsing context</a>'s <a data-link-type="dfn" href="#browsing-context-loading-mode" id="ref-for-browsing-context-loading-mode②">loading mode</a> is always "<code>default</code>". </p>
   <p class="issue" id="issue-c1bc22a3"><a class="self-link" href="#issue-c1bc22a3"></a>Probably we will need more loading modes for handling <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context" id="ref-for-nested-browsing-context①">nested browsing contexts</a> inside of top-level prerendered ones. Definitely a to-do.</p>
   <p>A <a data-link-type="dfn" href="#prerendering-browsing-context" id="ref-for-prerendering-browsing-context①">prerendering browsing context</a> is <dfn class="dfn-paneled" data-dfn-for="prerendering browsing context" data-dfn-type="dfn" data-noexport id="prerendering-browsing-context-empty">empty</dfn> if the only entry in its <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/history.html#session-history" id="ref-for-session-history">session history</a> is the initial <code>about:blank</code> <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document">Document</a></code>.</p>
   <p>Every <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document①">Document</a></code> has a <dfn class="dfn-paneled" data-dfn-for="Document" data-dfn-type="dfn" data-noexport id="document-prerendering-browsing-contexts-map">prerendering browsing contexts map</dfn>, which is an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map④">ordered map</a> of (<a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url③">URL</a>, <a data-link-type="dfn" href="https://w3c.github.io/webappsec-referrer-policy/#referrer-policy" id="ref-for-referrer-policy①">referrer policy</a>) <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#tuple" id="ref-for-tuple">tuples</a> to <a data-link-type="dfn" href="#prerendering-browsing-context" id="ref-for-prerendering-browsing-context②">prerendering browsing contexts</a>. This is used to fulfill <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate" id="ref-for-navigate">navigations</a> to a given URL by instead <a data-link-type="dfn" href="#prerendering-browsing-context-activate" id="ref-for-prerendering-browsing-context-activate">activating</a> the corresponding prerendering browsing context.</p>
   <p>Every <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document②">Document</a></code> has a <dfn class="dfn-paneled" data-dfn-for="Document" data-dfn-type="dfn" data-noexport id="document-post-prerendering-activation-steps-list">post-prerendering activation steps list</dfn>, which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list⑨">list</a> where each <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-item" id="ref-for-list-item">item</a> is a series of algorithm steps. For convenience, we define the <dfn class="dfn-paneled" data-dfn-for="platform object" data-dfn-type="dfn" data-noexport id="platform-object-post-prerendering-activation-steps-list">post-prerendering activation steps list</dfn> for any platform object <var>platformObject</var> as:</p>
   <dl class="switch">
    <dt data-md>If <var>platformObject</var> is a <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node" id="ref-for-concept-node">node</a>
    <dd data-md>
     <ol>
      <li data-md>
       <p>Return <var>platformObject</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document" id="ref-for-concept-node-document⑤">node document</a>'s <a data-link-type="dfn" href="#document-post-prerendering-activation-steps-list" id="ref-for-document-post-prerendering-activation-steps-list">post-prerendering activation steps list</a>.</p>
     </ol>
    <dt data-md>Otherwise
    <dd data-md>
     <ol>
      <li data-md>
       <p class="assertion">Assert: <var>platformObject</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global①">relevant global object</a> is a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/window-object.html#window" id="ref-for-window">Window</a></code> object.</p>
     </ol>
    <dd data-md>
     <ol>
      <li data-md>
       <p>Return <var>platformObject</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global②">relevant global object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#concept-document-window" id="ref-for-concept-document-window">associated Document</a>'s <a data-link-type="dfn" href="#document-post-prerendering-activation-steps-list" id="ref-for-document-post-prerendering-activation-steps-list①">post-prerendering activation steps list</a>.</p>
     </ol>
   </dl>
   <div class="algorithm" data-algorithm="create a prerendering browsing context">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="create-a-prerendering-browsing-context">create a prerendering browsing context</dfn> given a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url④">URL</a> <var>startingURL</var>, a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-referrer-policy/#referrer-policy" id="ref-for-referrer-policy②">referrer policy</a> <var>referrerPolicy</var>, and a <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document③">Document</a></code> <var>referrerDoc</var>: 
    <ol>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert①">Assert</a>: <var>startingURL</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme" id="ref-for-concept-url-scheme②">scheme</a> is an <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#http-scheme" id="ref-for-http-scheme②">HTTP(S) scheme</a>.</p>
     <li data-md>
      <p>If <var>referrerDoc</var>’s <a data-link-type="dfn" href="#document-prerendering-browsing-contexts-map" id="ref-for-document-prerendering-browsing-contexts-map">prerendering browsing contexts map</a>[(<var>startingURL</var>, <var>referrerPolicy</var>)] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists⑤">exists</a>, then return.</p>
     <li data-md>
      <p>Let <var>bc</var> be the result of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#creating-a-new-top-level-browsing-context" id="ref-for-creating-a-new-top-level-browsing-context">creating a new top-level browsing context</a>.</p>
     <li data-md>
      <p>Set <var>bc</var>’s <a data-link-type="dfn" href="#browsing-context-loading-mode" id="ref-for-browsing-context-loading-mode③">loading mode</a> to "<code>prerender</code>".</p>
     <li data-md>
      <p>If <var>startingURL</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin①">origin</a> is not <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#same-origin" id="ref-for-same-origin①">same origin</a> with <var>referrerDoc</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-origin" id="ref-for-concept-document-origin①">origin</a>, run these steps:</p>
      <ol>
       <li data-md>
        <p>Set <var>bc</var>’s <a data-link-type="dfn" href="#browsing-context-loading-mode" id="ref-for-browsing-context-loading-mode④">loading mode</a> to "<code>uncredentialed-prerender</code>".</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert②">Assert</a>: The <a data-link-type="dfn" href="#list-of-sufficiently-strict-speculative-navigation-referrer-policies" id="ref-for-list-of-sufficiently-strict-speculative-navigation-referrer-policies①">list of sufficiently-strict speculative navigation referrer policies</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain③">contains</a> <var>referrerPolicy</var>.</p>
      </ol>
     <li data-md>
      <p>Set <var>referrerDoc</var>’s <a data-link-type="dfn" href="#document-prerendering-browsing-contexts-map" id="ref-for-document-prerendering-browsing-contexts-map①">prerendering browsing contexts map</a>[<var>startingURL</var>] to <var>bc</var>.</p>
     <li data-md>
      <p>Let <var>request</var> be a new <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request">request</a> whose <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url">URL</a> is <var>startingURL</var> and <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-referrer-policy" id="ref-for-concept-request-referrer-policy">referrer policy</a> is <var>referrerPolicy</var>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate" id="ref-for-navigate①">Navigate</a> <var>bc</var> to <var>request</var> with the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#source-browsing-context" id="ref-for-source-browsing-context">source browsing context</a> set to <var>referrerDoc</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-document-bc" id="ref-for-concept-document-bc">browsing context</a>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="activate" data-algorithm-for="prerendering browsing context">
     To <dfn class="dfn-paneled" data-dfn-for="prerendering browsing context" data-dfn-type="dfn" data-noexport id="prerendering-browsing-context-activate">activate</dfn> a <a data-link-type="dfn" href="#prerendering-browsing-context" id="ref-for-prerendering-browsing-context③">prerendering browsing context</a> <var>successorBC</var> in place of a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#top-level-browsing-context" id="ref-for-top-level-browsing-context①">top-level browsing context</a> <var>predecessorBC</var> given a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#history-handling-behavior" id="ref-for-history-handling-behavior">history handling behavior</a> <var>historyHandling</var>: 
    <ol>
     <li data-md>
      <p class="assertion">Assert: <var>historyHandling</var> is either "<code>default</code>" or "<code>replace</code>".</p>
     <li data-md>
      <p class="assertion">Assert: <var>successorBC</var> is not <a data-link-type="dfn" href="#prerendering-browsing-context-empty" id="ref-for-prerendering-browsing-context-empty">empty</a>.</p>
     <li data-md>
      <p class="assertion">Assert: <var>predecessorBC</var> is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#top-level-browsing-context" id="ref-for-top-level-browsing-context②">top-level browsing context</a>.</p>
     <li data-md>
      <p>Cancel any preexisting but not yet <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#concept-navigate-mature" id="ref-for-concept-navigate-mature">mature</a> attempts to navigate <var>predecessorBC</var>, including canceling any instances of the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch" id="ref-for-concept-fetch">fetch</a> algorithm started by those attempts. If one of those attempts has already <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#initialise-the-document-object" id="ref-for-initialise-the-document-object">created and initialized a new <code>Document</code> object</a>, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#abort-a-document" id="ref-for-abort-a-document">abort</a> that <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document④">Document</a></code> also.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#prompt-to-unload-a-document" id="ref-for-prompt-to-unload-a-document">Prompt to unload</a> the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#active-document" id="ref-for-active-document">active document</a> of <var>predecessorBC</var>. If the user <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#refused-to-allow-the-document-to-be-unloaded" id="ref-for-refused-to-allow-the-document-to-be-unloaded">refused to allow the document to be unloaded</a>, then return.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#abort-a-document" id="ref-for-abort-a-document①">Abort</a> the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#active-document" id="ref-for-active-document①">active document</a> of <var>predecessorBC</var>.</p>
     <li data-md>
      <p>TODO prepend the existing session history of <var>predecessorBC</var> into <var>successorBC</var>? Or, probably better, use the new "browsing session" concept to bridge them? Be sure to respect <var>historyHandling</var>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel">In parallel</a>:</p>
      <ol>
       <li data-md>
        <p>Update the user agent’s user interface to replace <var>predecessorBC</var> with <var>successorBC</var>, e.g., by updating the tab/window contents and the browser chrome.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task①">Queue a global task</a> on the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#networking-task-source" id="ref-for-networking-task-source">networking task source</a> given <var>successorBC</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#active-window" id="ref-for-active-window">active window</a> to perform the following steps</p>
        <ol>
         <li data-md>
          <p>Set <var>successorBC</var>’s <a data-link-type="dfn" href="#browsing-context-loading-mode" id="ref-for-browsing-context-loading-mode⑤">loading mode</a> to "<code>default</code>".</p>
         <li data-md>
          <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire" id="ref-for-concept-event-fire">Fire an event</a> named <code class="idl"><a data-link-type="idl" href="#eventdef-document-prerenderingchange" id="ref-for-eventdef-document-prerenderingchange">prerenderingchange</a></code> at <var>successorBC</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#active-document" id="ref-for-active-document②">active document</a>.</p>
         <li data-md>
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate⑧">For each</a> <var>steps</var> in <var>successorBC</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#active-document" id="ref-for-active-document③">active document</a>'s <a data-link-type="dfn" href="#document-post-prerendering-activation-steps-list" id="ref-for-document-post-prerendering-activation-steps-list②">post-prerendering activation steps list</a>:</p>
          <ol>
           <li data-md>
            <p>Run <var>steps</var>.</p>
            <p class="note" role="note">These steps might return something, like a <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-promise" id="ref-for-idl-promise">Promise</a></code>. That is just an artifact of how the spec is modified; such return values can always be ignored. </p>
           <li data-md>
            <p class="assertion">Assert: running <var>steps</var> did not throw an exception.</p>
          </ol>
         <li data-md>
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-empty" id="ref-for-list-empty">Empty</a> <var>successorBC</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#active-document" id="ref-for-active-document④">active document</a>'s <a data-link-type="dfn" href="#document-post-prerendering-activation-steps-list" id="ref-for-document-post-prerendering-activation-steps-list③">post-prerendering activation steps list</a>.</p>
        </ol>
      </ol>
    </ol>
   </div>
   <hr>
   <p>Amend the <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document⑤">Document</a></code> interface:</p>
<pre class="idl highlight def"><c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://dom.spec.whatwg.org/#document" id="ref-for-document⑥"><c- g>Document</c-></a> {
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-boolean" id="ref-for-idl-boolean"><c- b>boolean</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="boolean" href="#dom-document-prerendering" id="ref-for-dom-document-prerendering"><c- g>prerendering</c-></a>;
    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler"><c- n>EventHandler</c-></a> <a class="idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-document-onprerenderingchange" id="ref-for-dom-document-onprerenderingchange"><c- g>onprerenderingchange</c-></a>;
};
</pre>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="Document" data-dfn-type="attribute" data-export id="dom-document-prerendering"><code>prerendering</code></dfn> getter steps are to return true if <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this">this</a> has a non-null <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-document-bc" id="ref-for-concept-document-bc①">browsing context</a> that is a <a data-link-type="dfn" href="#prerendering-browsing-context" id="ref-for-prerendering-browsing-context④">prerendering browsing context</a>; otherwise, false.</p>
   <p class="note" role="note">This attribute lets pages know when they’re being presented in a non-interactive "prerendering-like" context. In the future, this would include a visible document in a <code>&lt;portal></code> element, both when loaded into it or via predecessor adoption. </p>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="Document" data-dfn-type="attribute" data-export id="dom-document-onprerenderingchange"><code>onprerenderingchange</code></dfn> attribute is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes" id="ref-for-event-handler-idl-attributes">event handler IDL attribute</a> corresponding to the <dfn class="dfn-paneled idl-code" data-dfn-for="Document" data-dfn-type="event" data-export id="eventdef-document-prerenderingchange"><code>prerenderingchange</code></dfn> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type" id="ref-for-event-handler-event-type">event handler event type</a>.</p>
   <h2 class="heading settled" data-level="4" id="navigation"><span class="secno">4. </span><span class="content">Navigation and session history</span><a class="self-link" href="#navigation"></a></h2>
   <h3 class="heading settled" data-level="4.1" id="navigate-activation"><span class="secno">4.1. </span><span class="content">Allowing activation in place of navigation</span><a class="self-link" href="#navigate-activation"></a></h3>
   <div class="algorithm" data-algorithm="can activate a prerender">
     We <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="can-activate-a-prerender">can activate a prerender</dfn> given a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context" id="ref-for-browsing-context②">browsing context</a> <var>browsingContext</var>, a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#history-handling-behavior" id="ref-for-history-handling-behavior①">history handling behavior</a> <var>historyHandling</var>, a string <var>navigationType</var>, and a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request①">request</a> <var>request</var>, if the following steps return true: 
    <ol>
     <li data-md>
      <p>Return true if all of the following are true:</p>
      <ul>
       <li data-md>
        <p><var>browsingContext</var> is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#top-level-browsing-context" id="ref-for-top-level-browsing-context③">top-level browsing context</a></p>
       <li data-md>
        <p><var>browsingContext</var> is not a <a data-link-type="dfn" href="#prerendering-browsing-context" id="ref-for-prerendering-browsing-context⑤">prerendering browsing context</a></p>
       <li data-md>
        <p><var>historyHandling</var> is "<code>default</code>" or "<code>replace</code>"</p>
       <li data-md>
        <p><var>navigationType</var> is "<code>other</code>"</p>
       <li data-md>
        <p><var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-method" id="ref-for-concept-request-method">method</a> is `<code>GET</code>`</p>
       <li data-md>
        <p><var>browsingContext</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#active-document" id="ref-for-active-document⑤">active document</a>'s <a data-link-type="dfn" href="#document-prerendering-browsing-contexts-map" id="ref-for-document-prerendering-browsing-contexts-map②">prerendering browsing contexts map</a>[(<var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url①">URL</a>, <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-referrer-policy" id="ref-for-concept-request-referrer-policy①">referrer policy</a>)] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists⑥">exists</a> and is not <a data-link-type="dfn" href="#prerendering-browsing-context-empty" id="ref-for-prerendering-browsing-context-empty①">empty</a></p>
      </ul>
     <li data-md>
      <p>Otherwise, return false.</p>
    </ol>
   </div>
   <p>Patch the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate" id="ref-for-navigate②">navigate</a> algorithm to allow the <a data-link-type="dfn" href="#prerendering-browsing-context-activate" id="ref-for-prerendering-browsing-context-activate①">activation</a> of a <a data-link-type="dfn" href="#prerendering-browsing-context" id="ref-for-prerendering-browsing-context⑥">prerendering browsing context</a> in place of a normal navigation as follows:</p>
   <div class="algorithm" data-algorithm="navigate activate patch">
     In <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate" id="ref-for-navigate③">navigate</a>, append the following steps after the fragment navigation handling (currently step 6): 
    <ol>
     <li data-md>
      <p>If <var>resource</var> is a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request②">request</a> and we <a data-link-type="dfn" href="#can-activate-a-prerender" id="ref-for-can-activate-a-prerender">can activate a prerender</a> given <var>browsingContext</var>, <var>historyHandling</var>, <var>navigationType</var>, and <var>resource</var>, then:</p>
      <ol>
       <li data-md>
        <p><a data-link-type="dfn" href="#prerendering-browsing-context-activate" id="ref-for-prerendering-browsing-context-activate②">Activate</a> <var>successorBC</var> in place of <var>browsingContext</var> given <var>historyHandling</var>.</p>
       <li data-md>
        <p>Return.</p>
      </ol>
    </ol>
   </div>
   <p>Navigation redirects can also <a data-link-type="dfn" href="#prerendering-browsing-context-activate" id="ref-for-prerendering-browsing-context-activate③">activate</a> <a data-link-type="dfn" href="#prerendering-browsing-context" id="ref-for-prerendering-browsing-context⑦">prerendering browsing contexts</a>. This is defined in the <a href="#redirect-handling">§ 4.2 Redirect handling</a> section.</p>
   <h3 class="heading settled" data-level="4.2" id="redirect-handling"><span class="secno">4.2. </span><span class="content">Redirect handling</span><a class="self-link" href="#redirect-handling"></a></h3>
   <p>This section contains two types of changes to the navigation redirect handling portion of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#process-a-navigate-fetch" id="ref-for-process-a-navigate-fetch">process a navigate fetch</a> algorithm:</p>
   <ul>
    <li data-md>
     <p>Logic allowing navigation redirects that are not inside of a <a data-link-type="dfn" href="#prerendering-browsing-context" id="ref-for-prerendering-browsing-context⑧">prerendering browsing context</a> to <a data-link-type="dfn" href="#prerendering-browsing-context-activate" id="ref-for-prerendering-browsing-context-activate④">activate</a> a <a data-link-type="dfn" href="#prerendering-browsing-context" id="ref-for-prerendering-browsing-context⑨">prerendering browsing context</a>.</p>
    <li data-md>
     <p>Logic that updates specific state of a <a data-link-type="dfn" href="#prerendering-browsing-context" id="ref-for-prerendering-browsing-context①⓪">prerendering browsing context</a> when it redirects coss-origin.</p>
   </ul>
   <p>Patch the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#process-a-navigate-fetch" id="ref-for-process-a-navigate-fetch①">process a navigate fetch</a> algorithm like so:</p>
   <div class="algorithm" data-algorithm="navigate activate patch redirect handling">
     In <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#process-a-navigate-fetch" id="ref-for-process-a-navigate-fetch②">process a navigate fetch</a>, append the following steps after the first sub-step under "While true:" in order to handle redirects correctly: 
    <ol>
     <li data-md>
      <p>If we <a data-link-type="dfn" href="#can-activate-a-prerender" id="ref-for-can-activate-a-prerender①">can activate a prerender</a> given <var>browsingContext</var>, <var>historyHandling</var>, <var>navigationType</var>, and <var>request</var>, then:</p>
      <ol>
       <li data-md>
        <p><a data-link-type="dfn" href="#prerendering-browsing-context-activate" id="ref-for-prerendering-browsing-context-activate⑤">Activate</a> <var>browsingContext</var> in place of <var>sourceBrowsingContext</var> given <var>historyHandling</var>.</p>
       <li data-md>
        <p>Return.</p>
      </ol>
     <li data-md>
      <p>If <var>browsingContext</var> is a <a data-link-type="dfn" href="#prerendering-browsing-context" id="ref-for-prerendering-browsing-context①①">prerendering browsing context</a> and <var>currentURL</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin②">origin</a> is not <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#same-origin" id="ref-for-same-origin②">same origin</a> with <var>incumbentNavigationOrigin</var>, then:</p>
      <ol>
       <li data-md>
        <p>Set <var>browsingContext</var>’s <a data-link-type="dfn" href="#browsing-context-loading-mode" id="ref-for-browsing-context-loading-mode⑥">loading mode</a> to "<code>uncredentialed-prerender</code>".</p>
       <li data-md>
        <p>If the <a data-link-type="dfn" href="#list-of-sufficiently-strict-speculative-navigation-referrer-policies" id="ref-for-list-of-sufficiently-strict-speculative-navigation-referrer-policies②">list of sufficiently-strict speculative navigation referrer policies</a> does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain④">contain</a> <var>request</var>’s <a data-link-type="dfn" href="https://w3c.github.io/webappsec-referrer-policy/#referrer-policy" id="ref-for-referrer-policy③">referrer policy</a>, then:</p>
        <ol>
         <li data-md>
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert③">Assert</a>: <var>response</var> is not null.</p>
         <li data-md>
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert④">Assert</a>: <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-location-url" id="ref-for-concept-response-location-url">location URL</a> is a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url⑤">URL</a> whose <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme" id="ref-for-concept-url-scheme③">scheme</a> is a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#http-scheme" id="ref-for-http-scheme③">HTTP(S) scheme</a>.</p>
         <li data-md>
          <p>Set <var>response</var> to a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-network-error" id="ref-for-concept-network-error">network error</a> and <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-break" id="ref-for-iteration-break">break</a>.</p>
        </ol>
      </ol>
    </ol>
   </div>
   <h3 class="heading settled" data-level="4.3" id="always-replacement"><span class="secno">4.3. </span><span class="content">Maintaining a trivial session history</span><a class="self-link" href="#always-replacement"></a></h3>
   <div class="algorithm" data-algorithm="navigate historyHandling patch">
     Patch the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate" id="ref-for-navigate④">navigate</a> algorithm to ensure the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/history.html#session-history" id="ref-for-session-history①">session history</a> of a <a data-link-type="dfn" href="#prerendering-browsing-context" id="ref-for-prerendering-browsing-context①②">prerendering browsing context</a> stays trivial by prepending the following step before all others: 
    <ol>
     <li data-md>
      <p>If <var>browsingContext</var> is a <a data-link-type="dfn" href="#prerendering-browsing-context" id="ref-for-prerendering-browsing-context①③">prerendering browsing context</a>, then:</p>
      <ol>
       <li data-md>
        <p class="assertion">Assert: <var>historyHandling</var> is not "<code>entry update</code>", since prerendering browsing contexts have trivial session histories and thus will never end up <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#traverse-the-history" id="ref-for-traverse-the-history">traversing</a> back to an entry with null <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#she-document" id="ref-for-she-document">document</a>.</p>
       <li data-md>
        <p>If <var>historyHandling</var> is "<code>default</code>", then set <var>historyHandling</var> to "<code>replace</code>".</p>
      </ol>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="URL and history update steps patch">
     Patch the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/history.html#url-and-history-update-steps" id="ref-for-url-and-history-update-steps">URL and history update steps</a> by adding the following step after step 1: 
    <ol>
     <li data-md>
      <p>If <var>browsingContext</var> is a <a data-link-type="dfn" href="#prerendering-browsing-context" id="ref-for-prerendering-browsing-context①④">prerendering browsing context</a>, then set <var>isPush</var> to false.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="4.4" id="no-bad-navs"><span class="secno">4.4. </span><span class="content">Preventing non-HTTP(S) navigations</span><a class="self-link" href="#no-bad-navs"></a></h3>
   <p>Patch the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate" id="ref-for-navigate⑤">navigate</a> algorithm to prevent certain navigations in a <a data-link-type="dfn" href="#prerendering-browsing-context" id="ref-for-prerendering-browsing-context①⑤">prerendering browsing context</a> as follows:</p>
   <p class="issue" id="issue-755a1cad"><a class="self-link" href="#issue-755a1cad"></a>Portals might need an extra hook to close the portal in these cases. Or should we reconsider and just do nothing for portals too? That might be more elegant. I think it just requires portals to not be so zealous about clearing the host element/browsing context link, which isn’t observable anyway? </p>
   <div class="algorithm" data-algorithm="process a navigate response patch">
     In <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#process-a-navigate-response" id="ref-for-process-a-navigate-response">process a navigate response</a>, append the following after the step which establishes the value of <var>failure</var>, but before the step which uses it to display an error page: 
    <ol>
     <li data-md>
      <p>If <var>browsingContext</var> is a <a data-link-type="dfn" href="#prerendering-browsing-context" id="ref-for-prerendering-browsing-context①⑥">prerendering browsing context</a>, and any of the following hold:</p>
      <ul>
       <li data-md>
        <p><var>failure</var> is true;</p>
       <li data-md>
        <p><var>navigationParams</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params-request" id="ref-for-navigation-params-request">request</a> is null;</p>
       <li data-md>
        <p><var>navigationParams</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params-request" id="ref-for-navigation-params-request①">request</a>'s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-current-url" id="ref-for-concept-request-current-url">current URL</a>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme" id="ref-for-concept-url-scheme④">scheme</a> is not a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#http-scheme" id="ref-for-http-scheme④">HTTP(S) scheme</a>;</p>
       <li data-md>
        <p><var>response</var> has a `<code>Content-Disposition</code>` header specifying the <code>attachment</code> disposition type; or</p>
       <li data-md>
        <p><var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-status" id="ref-for-concept-response-status">status</a> is 204 or 205,</p>
      </ul>
      <p>then:</p>
      <ol>
       <li data-md>
        <p>Run the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-discarding-steps" id="ref-for-environment-discarding-steps">environment discarding steps</a> for <var>navigationParams</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params-reserved-environment" id="ref-for-navigation-params-reserved-environment">reserved environment</a>.</p>
       <li data-md>
        <p>Return.</p>
      </ol>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="process a navigate URL scheme patch">
     In <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#process-a-navigate-url-scheme" id="ref-for-process-a-navigate-url-scheme">process a navigate URL scheme</a>, insert the following step before the step
  which displays inline content: 
    <ol>
     <li data-md>
      <p>Otherwise, if <var>browsingContext</var> is a <a data-link-type="dfn" href="#prerendering-browsing-context" id="ref-for-prerendering-browsing-context①⑦">prerendering browsing context</a>, then return.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="4.5" id="cleanup-upon-discarding"><span class="secno">4.5. </span><span class="content">Cleanup upon discarding a <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document⑦">Document</a></code></span><a class="self-link" href="#cleanup-upon-discarding"></a></h3>
   <p>Modify the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#discard-a-document" id="ref-for-discard-a-document">discard</a> algorithm for <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document⑧">Document</a></code>s by appending the following step:</p>
   <div class="algorithm" data-algorithm="discard a Document patch">
    <ol>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-empty" id="ref-for-list-empty①">Empty</a> <var>document</var>’s <a data-link-type="dfn" href="#document-post-prerendering-activation-steps-list" id="ref-for-document-post-prerendering-activation-steps-list④">post-prerendering activation steps list</a>.</p>
    </ol>
   </div>
   <h2 class="heading settled" data-level="5" id="nonsense-behaviors"><span class="secno">5. </span><span class="content">Preventing nonsensical behaviors</span><a class="self-link" href="#nonsense-behaviors"></a></h2>
   <p>Some behaviors might make sense in most <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#top-level-browsing-context" id="ref-for-top-level-browsing-context④">top-level browsing contexts</a>, but do not make sense in <a data-link-type="dfn" href="#prerendering-browsing-context" id="ref-for-prerendering-browsing-context①⑧">prerendering browsing contexts</a>. This section enumerates specification patches to enforce such restrictions.</p>
   <h3 class="heading settled" data-level="5.1" id="patch-window-apis"><span class="secno">5.1. </span><span class="content">APIs for creating and navigating browsing contexts by name</span><a class="self-link" href="#patch-window-apis"></a></h3>
   <p>Modify the definition of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#script-closable" id="ref-for-script-closable">script-closable</a> to prevent window closing while in a <a data-link-type="dfn" href="#prerendering-browsing-context" id="ref-for-prerendering-browsing-context①⑨">prerendering browsing context</a>:</p>
   <p>A <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context" id="ref-for-browsing-context③">browsing context</a> is <dfn data-dfn-type="dfn" data-noexport id="script-closable">script-closable<a class="self-link" href="#script-closable"></a></dfn> if either of the following is true:</p>
   <ul>
    <li data-md>
     <p>it is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#auxiliary-browsing-context" id="ref-for-auxiliary-browsing-context">auxiliary browsing context</a> that was created by script (as opposed to by an action of the user); or</p>
    <li data-md>
     <p>
      it is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#top-level-browsing-context" id="ref-for-top-level-browsing-context⑤">top-level browsing context</a> 
      <ins>that is not a <a data-link-type="dfn" href="#prerendering-browsing-context" id="ref-for-prerendering-browsing-context②⓪">prerendering browsing context</a></ins>
       and whose <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/history.html#session-history" id="ref-for-session-history②">session history</a> contains only one <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document⑨">Document</a></code>.
     </p>
   </ul>
   <h2 class="heading settled" data-level="6" id="intrusive-behaviors"><span class="secno">6. </span><span class="content">Preventing intrusive behaviors</span><a class="self-link" href="#intrusive-behaviors"></a></h2>
   <p>Various behaviors are disallowed in <a data-link-type="dfn" href="#prerendering-browsing-context" id="ref-for-prerendering-browsing-context②①">prerendering browsing contexts</a> because they would be intrusive to the user, since the prerendered content is not being actively interacted with.</p>
   <h3 class="heading settled" data-level="6.1" id="patch-downloading"><span class="secno">6.1. </span><span class="content">Downloading resources</span><a class="self-link" href="#patch-downloading"></a></h3>
   <p>Modify the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/links.html#downloading-hyperlinks" id="ref-for-downloading-hyperlinks">downloads a hyperlink</a> algorithm to ensure that downloads inside <a data-link-type="dfn" href="#prerendering-browsing-context" id="ref-for-prerendering-browsing-context②②">prerendering browsing contexts</a> are delayed until <a data-link-type="dfn" href="#prerendering-browsing-context-activate" id="ref-for-prerendering-browsing-context-activate⑥">activation</a>, by inserting the following before the step which goes <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel①">in parallel</a>:</p>
   <div class="algorithm" data-algorithm="downloads a hyperlink patch">
    <ol>
     <li data-md>
      <p>If <var>subject</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document" id="ref-for-concept-node-document⑥">node document</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-document-bc" id="ref-for-concept-document-bc②">browsing context</a> is a <a data-link-type="dfn" href="#prerendering-browsing-context" id="ref-for-prerendering-browsing-context②③">prerendering browsing context</a>, then append the following step to <var>subject</var>’s <a data-link-type="dfn" href="#platform-object-post-prerendering-activation-steps-list" id="ref-for-platform-object-post-prerendering-activation-steps-list">post-prerendering activation steps list</a> and return.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="6.2" id="patch-modals"><span class="secno">6.2. </span><span class="content">User prompts</span><a class="self-link" href="#patch-modals"></a></h3>
   <div class="algorithm" data-algorithm="cannot show simple dialogs patch">
     Modify the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#cannot-show-simple-dialogs" id="ref-for-cannot-show-simple-dialogs">cannot show simple dialogs</a> algorithm, given a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/window-object.html#window" id="ref-for-window①">Window</a></code> <var>window</var>, by prepending the following step: 
    <ol>
     <li data-md>
      <p>If <var>window</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#window-bc" id="ref-for-window-bc">browsing context</a> is a <a data-link-type="dfn" href="#prerendering-browsing-context" id="ref-for-prerendering-browsing-context②④">prerendering browsing context</a>, then return true.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="window print() patch">
     Modify the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#dom-print" id="ref-for-dom-print">print()</a></code> method steps by prepending the following step: 
    <ol>
     <li data-md>
      <p>If <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this①">this</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#window-bc" id="ref-for-window-bc①">browsing context</a> is a <a data-link-type="dfn" href="#prerendering-browsing-context" id="ref-for-prerendering-browsing-context②⑤">prerendering browsing context</a>, then return.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="6.3" id="permissions"><span class="secno">6.3. </span><span class="content">Waiting before permissions checks</span><a class="self-link" href="#permissions"></a></h3>
   <p>Many specifications need to be patched so that, if a given algorithm invoked in a <a data-link-type="dfn" href="#prerendering-browsing-context" id="ref-for-prerendering-browsing-context②⑥">prerendering browsing context</a>, most of its work is deferred until the browsing context is <a data-link-type="dfn" href="#prerendering-browsing-context-activate" id="ref-for-prerendering-browsing-context-activate⑦">activated</a>. This is tricky to do uniformly, as many of these specifications do not have great hygeine around <a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop-for-spec-authors">using the event loop</a>. Nevertheless, the following sections give our best attempt.</p>
   <h4 class="heading settled" data-level="6.3.1" id="patch-geolocation"><span class="secno">6.3.1. </span><span class="content">Geolocation API</span><a class="self-link" href="#patch-geolocation"></a></h4>
   <div class="algorithm" data-algorithm="Geolocation getCurrentPosition patch">
     Modify the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/geolocation-api/#getcurrentposition-method" id="ref-for-getcurrentposition-method">getCurrentPosition()</a></code> method steps by prepending the following step: 
    <ol>
     <li data-md>
      <p>If <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this②">this</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global③">relevant global object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#window-bc" id="ref-for-window-bc②">browsing context</a> is a <a data-link-type="dfn" href="#prerendering-browsing-context" id="ref-for-prerendering-browsing-context②⑦">prerendering browsing context</a>, then append the following steps to <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this③">this</a>'s <a data-link-type="dfn" href="#platform-object-post-prerendering-activation-steps-list" id="ref-for-platform-object-post-prerendering-activation-steps-list①">post-prerendering activation steps list</a> and return.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="Geolocation watchPosition patch">
     Modify the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/geolocation-api/#watchposition-method" id="ref-for-watchposition-method">watchPosition()</a></code> method steps by prepending the following step: 
    <ol>
     <li data-md>
      <p>If <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this④">this</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global④">relevant global object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#window-bc" id="ref-for-window-bc③">browsing context</a> is a <a data-link-type="dfn" href="#prerendering-browsing-context" id="ref-for-prerendering-browsing-context②⑧">prerendering browsing context</a>, then:</p>
      <ol>
       <li data-md>
        <p>Let <var>watchProcessId</var> be a new unique <a data-link-type="dfn" href="https://w3c.github.io/geolocation-api/#dfn-watch-process" id="ref-for-dfn-watch-process">watch process</a> ID, and note it as a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="post-prerendering-activation-geolocation-watch-process-id">post-prerendering activation geolocation watch process ID</dfn>.</p>
       <li data-md>
        <p>Append the following steps to <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this⑤">this</a>'s <a data-link-type="dfn" href="#platform-object-post-prerendering-activation-steps-list" id="ref-for-platform-object-post-prerendering-activation-steps-list②">post-prerendering activation steps list</a>, with the modification that the <a data-link-type="dfn" href="https://w3c.github.io/geolocation-api/#dfn-watch-process" id="ref-for-dfn-watch-process①">watch process</a> generated must use <var>watchProcessId</var> as its ID, and return <var>watchProcessId</var>.</p>
      </ol>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="Geolocation clearWatch patch">
     Modify the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/geolocation-api/#clearwatch-method" id="ref-for-clearwatch-method">clearWatch(watchId)</a></code> method steps by prepending the following step: 
    <ol>
     <li data-md>
      <p>If <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this⑥">this</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global⑤">relevant global object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#window-bc" id="ref-for-window-bc④">browsing context</a> is a <a data-link-type="dfn" href="#prerendering-browsing-context" id="ref-for-prerendering-browsing-context②⑨">prerendering browsing context</a>, then:</p>
      <ol>
       <li data-md>
        <p>If <var>watchId</var> is a <a data-link-type="dfn" href="#post-prerendering-activation-geolocation-watch-process-id" id="ref-for-post-prerendering-activation-geolocation-watch-process-id">post-prerendering activation geolocation watch process ID</a>, then remove its corresponding steps from <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this⑦">this</a>'s <a data-link-type="dfn" href="#platform-object-post-prerendering-activation-steps-list" id="ref-for-platform-object-post-prerendering-activation-steps-list③">post-prerendering activation steps list</a>.</p>
       <li data-md>
        <p>Return.</p>
      </ol>
    </ol>
   </div>
   <h4 class="heading settled" data-level="6.3.2" id="patch-serial"><span class="secno">6.3.2. </span><span class="content">Web Serial API</span><a class="self-link" href="#patch-serial"></a></h4>
   <div class="algorithm" data-algorithm="Serial requestPort patch">
     Modify the <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/serial/#dom-serial-requestPort" id="ref-for-dom-serial-requestPort">requestPort()</a></code> method steps by inserting the following steps after the initial creation of <var>promise</var>: 
    <ol>
     <li data-md>
      <p>If <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this⑧">this</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global⑥">relevant global object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#window-bc" id="ref-for-window-bc⑤">browsing context</a> is a <a data-link-type="dfn" href="#prerendering-browsing-context" id="ref-for-prerendering-browsing-context③⓪">prerendering browsing context</a>, then append the following steps to <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this⑨">this</a>'s <a data-link-type="dfn" href="#platform-object-post-prerendering-activation-steps-list" id="ref-for-platform-object-post-prerendering-activation-steps-list④">post-prerendering activation steps list</a> and return <var>promise</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="Serial getPorts patch">
     Modify the <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/serial/#dom-serial-getports" id="ref-for-dom-serial-getports">getPorts()</a></code> method steps by inserting the following steps after the initial creation of <var>promise</var>: 
    <ol>
     <li data-md>
      <p>Let <var>document</var> be <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this①⓪">this</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global⑦">relevant global object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#concept-document-window" id="ref-for-concept-document-window①">associated Document</a>, if <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this①①">this</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global⑧">relevant global object</a> is a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/window-object.html#window" id="ref-for-window②">Window</a></code>, or <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this①②">this</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global⑨">relevant global object</a>'s owner document, if <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this①③">this</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global①⓪">relevant global object</a> is a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope" id="ref-for-dedicatedworkerglobalscope">DedicatedWorkerGlobalScope</a></code>.</p>
     <li data-md>
      <p>If <var>document</var> is null, then return <a data-link-type="dfn" href="https://heycam.github.io/webidl/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with">a promise rejected with</a> a "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#securityerror" id="ref-for-securityerror">SecurityError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException">DOMException</a></code>.</p>
     <li data-md>
      <p>If <var>document</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-document-bc" id="ref-for-concept-document-bc③">browsing context</a> is a <a data-link-type="dfn" href="#prerendering-browsing-context" id="ref-for-prerendering-browsing-context③①">prerendering browsing context</a>, then append the following steps to <var>document</var>’s <a data-link-type="dfn" href="#document-post-prerendering-activation-steps-list" id="ref-for-document-post-prerendering-activation-steps-list⑤">post-prerendering activation steps list</a> and return <var>promise</var>.</p>
    </ol>
   </div>
   <h4 class="heading settled" data-level="6.3.3" id="patch-notifications"><span class="secno">6.3.3. </span><span class="content">Notifications API</span><a class="self-link" href="#patch-notifications"></a></h4>
   <div class="algorithm" data-algorithm="Notification requestPermission patch">
     Modify the <code class="idl"><a data-link-type="idl" href="https://notifications.spec.whatwg.org/#dom-notification-requestpermission" id="ref-for-dom-notification-requestpermission">requestPermission()</a></code> method steps by inserting the following steps after the initial creation of <var>promise</var>: 
    <ol>
     <li data-md>
      <p>If <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this①④">this</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global①①">relevant global object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#window-bc" id="ref-for-window-bc⑥">browsing context</a> is a <a data-link-type="dfn" href="#prerendering-browsing-context" id="ref-for-prerendering-browsing-context③②">prerendering browsing context</a>, then append the following steps to <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this①⑤">this</a>'s <a data-link-type="dfn" href="#platform-object-post-prerendering-activation-steps-list" id="ref-for-platform-object-post-prerendering-activation-steps-list⑤">post-prerendering activation steps list</a> and return <var>promise</var>.</p>
    </ol>
   </div>
   <p>TODO: what about the service worker API? Depends on what we’re doing for service workers in prerendering BCs...</p>
   <h4 class="heading settled" data-level="6.3.4" id="patch-midi"><span class="secno">6.3.4. </span><span class="content">Web MIDI API</span><a class="self-link" href="#patch-midi"></a></h4>
   <div class="algorithm" data-algorithm="requestMIDIAccess patch">
     Modify the <code class="idl"><a data-link-type="idl" href="https://webaudio.github.io/web-midi-api/#dom-navigator-requestmidiaccess" id="ref-for-dom-navigator-requestmidiaccess">requestMIDIAccess()</a></code> method steps by inserting the following steps after the initial creation of <var>promise</var>: 
    <ol>
     <li data-md>
      <p>If <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this①⑥">this</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global①②">relevant global object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#window-bc" id="ref-for-window-bc⑦">browsing context</a> is a <a data-link-type="dfn" href="#prerendering-browsing-context" id="ref-for-prerendering-browsing-context③③">prerendering browsing context</a>, then append the following steps to <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this①⑦">this</a>'s <a data-link-type="dfn" href="#platform-object-post-prerendering-activation-steps-list" id="ref-for-platform-object-post-prerendering-activation-steps-list⑥">post-prerendering activation steps list</a> and return <var>promise</var>.</p>
    </ol>
   </div>
   <h4 class="heading settled" data-level="6.3.5" id="patch-idle-detection"><span class="secno">6.3.5. </span><span class="content">Idle Detection API</span><a class="self-link" href="#patch-idle-detection"></a></h4>
   <div class="algorithm" data-algorithm="IdleDetector start patch">
     Modify the <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/idle-detection/#api-idledetector-start" id="ref-for-api-idledetector-start">start()</a></code> method steps by inserting the following steps after the initial creation of <var>promise</var>: 
    <ol>
     <li data-md>
      <p>If <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this①⑧">this</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global①③">relevant global object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/window-object.html#window-bc" id="ref-for-window-bc⑧">browsing context</a> is a <a data-link-type="dfn" href="#prerendering-browsing-context" id="ref-for-prerendering-browsing-context③④">prerendering browsing context</a>, then append the following steps to <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this①⑨">this</a>'s <a data-link-type="dfn" href="#platform-object-post-prerendering-activation-steps-list" id="ref-for-platform-object-post-prerendering-activation-steps-list⑦">post-prerendering activation steps list</a> and return <var>promise</var>.</p>
    </ol>
   </div>
   <p class="note" role="note">The other interesting method, <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/idle-detection/#api-idledetector-requestpermission" id="ref-for-api-idledetector-requestpermission">IdleDetector.requestPermission()</a></code>, is gated on <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#transient-activation" id="ref-for-transient-activation">transient activation</a>. However, even if permission was previously granted for the origin in question, we delay starting any idle detectors while prerendering. </p>
   <h4 class="heading settled" data-level="6.3.6" id="activation-gated"><span class="secno">6.3.6. </span><span class="content">Activation-gated APIs</span><a class="self-link" href="#activation-gated"></a></h4>
   <p>The following APIs do not need modifications, because they will automatically fail or no-op without <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#transient-activation" id="ref-for-transient-activation①">transient activation</a> or <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#sticky-activation" id="ref-for-sticky-activation">sticky activation</a>, which a <a data-link-type="dfn" href="#prerendering-browsing-context" id="ref-for-prerendering-browsing-context③⑤">prerendering browsing context</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#active-window" id="ref-for-active-window①">active window</a> will never have. We list them here for completeness, to show which API surfaces we’ve audited.</p>
   <ul>
    <li data-md>
     <p><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/dynamic-markup-insertion.html#dom-document-open-window" id="ref-for-dom-document-open-window">window.open()</a></code> <a data-link-type="biblio" href="#biblio-html">[HTML]</a></p>
    <li data-md>
     <p>The prompt generated by the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/indices.html#event-beforeunload" id="ref-for-event-beforeunload">beforeunload</a></code> event <a data-link-type="biblio" href="#biblio-html">[HTML]</a></p>
    <li data-md>
     <p><code class="idl"><a data-link-type="idl" href="https://fullscreen.spec.whatwg.org/#dom-element-requestfullscreen" id="ref-for-dom-element-requestfullscreen">element.requestFullscreen()</a></code> <a data-link-type="biblio" href="#biblio-fullscreen">[FULLSCREEN]</a></p>
    <li data-md>
     <p><code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/payment-request/#dom-paymentrequest-show" id="ref-for-dom-paymentrequest-show">paymentRequest.show()</a></code> <a data-link-type="biblio" href="#biblio-payment-request">[PAYMENT-REQUEST]</a></p>
    <li data-md>
     <p><code class="idl"><a data-link-type="idl" href="https://w3c.github.io/presentation-api/#dom-presentationrequest-start" id="ref-for-dom-presentationrequest-start">presentationRequest.start()</a></code> <a data-link-type="biblio" href="#biblio-presentation-api">[PRESENTATION-API]</a></p>
    <li data-md>
     <p><code class="idl"><a data-link-type="idl" href="https://wicg.github.io/file-system-access/#dom-window-showopenfilepicker" id="ref-for-dom-window-showopenfilepicker">showOpenFilePicker()</a></code>, <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/file-system-access/#dom-window-showsavefilepicker" id="ref-for-dom-window-showsavefilepicker">showSaveFilePicker()</a></code>, and <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/file-system-access/#dom-window-showdirectorypicker" id="ref-for-dom-window-showdirectorypicker">showDirectoryPicker()</a></code> <a data-link-type="biblio" href="#biblio-file-system-access">[FILE-SYSTEM-ACCESS]</a></p>
    <li data-md>
     <p><code class="idl"><a data-link-type="idl" href="https://wicg.github.io/idle-detection/#api-idledetector-requestpermission" id="ref-for-api-idledetector-requestpermission①">IdleDetector.requestPermission()</a></code> <a data-link-type="biblio" href="#biblio-idle-detection">[IDLE-DETECTION]</a></p>
   </ul>
   <h2 class="heading settled" data-level="7" id="todo"><span class="secno">7. </span><span class="content">TODO</span><a class="self-link" href="#todo"></a></h2>
   <ul>
    <li data-md>
     <p>Spec all the actual restrictions (storage, intrusive APIs, uncredentialed fetching)</p>
    <li data-md>
     <p>Ensure navigations get aborted, and the map emptied, on non-opt-in cases for uncredentialed. Potential race conditions here; maybe we shouldn’t fill the map until navigation succeeds.</p>
    <li data-md>
     <p>CSP prefetch-src check (should this be done at create time?)</p>
    <li data-md>
     <p>CSP navigate-to check</p>
    <li data-md>
     <p>JS API</p>
   </ul>
  </main>
<script>
(function() {
  "use strict";
  var collapseSidebarText = '<span aria-hidden="true">←</span> '
                          + '<span>Collapse Sidebar</span>';
  var expandSidebarText   = '<span aria-hidden="true">→</span> '
                          + '<span>Pop Out Sidebar</span>';
  var tocJumpText         = '<span aria-hidden="true">↑</span> '
                          + '<span>Jump to Table of Contents</span>';

  var sidebarMedia = window.matchMedia('screen and (min-width: 78em)');
  var autoToggle   = function(e){ toggleSidebar(e.matches) };
  if(sidebarMedia.addListener) {
    sidebarMedia.addListener(autoToggle);
  }

  function toggleSidebar(on) {
    if (on == undefined) {
      on = !document.body.classList.contains('toc-sidebar');
    }

    /* Don’t scroll to compensate for the ToC if we’re above it already. */
    var headY = 0;
    var head = document.querySelector('.head');
    if (head) {
      // terrible approx of "top of ToC"
      headY += head.offsetTop + head.offsetHeight;
    }
    var skipScroll = window.scrollY < headY;

    var toggle = document.getElementById('toc-toggle');
    var tocNav = document.getElementById('toc');
    if (on) {
      var tocHeight = tocNav.offsetHeight;
      document.body.classList.add('toc-sidebar');
      document.body.classList.remove('toc-inline');
      toggle.innerHTML = collapseSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, 0 - tocHeight);
      }
      tocNav.focus();
      sidebarMedia.addListener(autoToggle); // auto-collapse when out of room
    }
    else {
      document.body.classList.add('toc-inline');
      document.body.classList.remove('toc-sidebar');
      toggle.innerHTML = expandSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, tocNav.offsetHeight);
      }
      if (toggle.matches(':hover')) {
        /* Unfocus button when not using keyboard navigation,
           because I don’t know where else to send the focus. */
        toggle.blur();
      }
    }
  }

  function createSidebarToggle() {
    /* Create the sidebar toggle in JS; it shouldn’t exist when JS is off. */
    var toggle = document.createElement('a');
      /* This should probably be a button, but appearance isn’t standards-track.*/
    toggle.id = 'toc-toggle';
    toggle.class = 'toc-toggle';
    toggle.href = '#toc';
    toggle.innerHTML = collapseSidebarText;

    sidebarMedia.addListener(autoToggle);
    var toggler = function(e) {
      e.preventDefault();
      sidebarMedia.removeListener(autoToggle); // persist explicit off states
      toggleSidebar();
      return false;
    }
    toggle.addEventListener('click', toggler, false);


    /* Get <nav id=toc-nav>, or make it if we don’t have one. */
    var tocNav = document.getElementById('toc-nav');
    if (!tocNav) {
      tocNav = document.createElement('p');
      tocNav.id = 'toc-nav';
      /* Prepend for better keyboard navigation */
      document.body.insertBefore(tocNav, document.body.firstChild);
    }
    /* While we’re at it, make sure we have a Jump to Toc link. */
    var tocJump = document.getElementById('toc-jump');
    if (!tocJump) {
      tocJump = document.createElement('a');
      tocJump.id = 'toc-jump';
      tocJump.href = '#toc';
      tocJump.innerHTML = tocJumpText;
      tocNav.appendChild(tocJump);
    }

    tocNav.appendChild(toggle);
  }

  var toc = document.getElementById('toc');
  if (toc) {
    createSidebarToggle();
    toggleSidebar(sidebarMedia.matches);

    /* If the sidebar has been manually opened and is currently overlaying the text
       (window too small for the MQ to add the margin to body),
       then auto-close the sidebar once you click on something in there. */
    toc.addEventListener('click', function(e) {
      if(e.target.tagName.toLowerCase() == "a" && document.body.classList.contains('toc-sidebar') && !sidebarMedia.matches) {
        toggleSidebar(false);
      }
    }, false);
  }
  else {
    console.warn("Can’t find Table of Contents. Please use <nav id='toc'> around the ToC.");
  }

  /* Wrap tables in case they overflow */
  var tables = document.querySelectorAll(':not(.overlarge) > table.data, :not(.overlarge) > table.index');
  var numTables = tables.length;
  for (var i = 0; i < numTables; i++) {
    var table = tables[i];
    var wrapper = document.createElement('div');
    wrapper.className = 'overlarge';
    table.parentNode.insertBefore(wrapper, table);
    wrapper.appendChild(table);
  }

})();
</script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#prerendering-browsing-context-activate">activate</a><span>, in §3</span>
   <li><a href="#can-activate-a-prerender">can activate a prerender</a><span>, in §4.1</span>
   <li><a href="#consider-speculation">consider speculation</a><span>, in §2.5</span>
   <li><a href="#create-a-prerendering-browsing-context">create a prerendering browsing context</a><span>, in §3</span>
   <li><a href="#prerendering-browsing-context-empty">empty</a><span>, in §3</span>
   <li><a href="#document-list-of-speculation-rule-sets">list of speculation rule sets</a><span>, in §2.5</span>
   <li><a href="#list-of-sufficiently-strict-speculative-navigation-referrer-policies">list of sufficiently-strict speculative navigation referrer policies</a><span>, in §1</span>
   <li><a href="#browsing-context-loading-mode">loading mode</a><span>, in §3</span>
   <li><a href="#dom-document-onprerenderingchange">onprerenderingchange</a><span>, in §3</span>
   <li><a href="#parse-a-speculation-rule">parse a speculation rule</a><span>, in §2.4</span>
   <li><a href="#parse-speculation-rules">parse speculation rules</a><span>, in §2.4</span>
   <li><a href="#post-prerendering-activation-geolocation-watch-process-id">post-prerendering activation geolocation watch process ID</a><span>, in §6.3.1</span>
   <li>
    post-prerendering activation steps list
    <ul>
     <li><a href="#document-post-prerendering-activation-steps-list">dfn for Document</a><span>, in §3</span>
     <li><a href="#platform-object-post-prerendering-activation-steps-list">dfn for platform object</a><span>, in §3</span>
    </ul>
   <li><a href="#speculation-rule-set-prefetch-rules">prefetch rules</a><span>, in §2.1</span>
   <li><a href="#speculation-rule-set-prefetch-with-subresources-rules">prefetch-with-subresources rules</a><span>, in §2.1</span>
   <li><a href="#attr-valuedef-link-rel-prerender">prerender</a><span>, in §1</span>
   <li><a href="#dom-document-prerendering">prerendering</a><span>, in §3</span>
   <li><a href="#prerendering-browsing-context">prerendering browsing context</a><span>, in §3</span>
   <li><a href="#document-prerendering-browsing-contexts-map">prerendering browsing contexts map</a><span>, in §3</span>
   <li><a href="#eventdef-document-prerenderingchange">prerenderingchange</a><span>, in §3</span>
   <li><a href="#speculation-rule-requirements">requirements</a><span>, in §2.1</span>
   <li><a href="#script-closable">script-closable</a><span>, in §5.1</span>
   <li><a href="#speculation-rule">speculation rule</a><span>, in §2.1</span>
   <li><a href="#speculation-rule-set">speculation rule set</a><span>, in §2.1</span>
   <li><a href="#the-scripts-result">the script’s result</a><span>, in §2.2</span>
   <li><a href="#speculation-rule-urls">URLs</a><span>, in §2.1</span>
  </ul>
  <aside class="dfn-panel" data-for="term-for-document">
   <a href="https://dom.spec.whatwg.org/#document">https://dom.spec.whatwg.org/#document</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-document">3. Prerendering browsing contexts</a> <a href="#ref-for-document①">(2)</a> <a href="#ref-for-document②">(3)</a> <a href="#ref-for-document③">(4)</a> <a href="#ref-for-document④">(5)</a> <a href="#ref-for-document⑤">(6)</a> <a href="#ref-for-document⑥">(7)</a>
    <li><a href="#ref-for-document⑦">4.5. Cleanup upon discarding a Document</a> <a href="#ref-for-document⑧">(2)</a>
    <li><a href="#ref-for-document⑨">5.1. APIs for creating and navigating browsing contexts by name</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-document">
   <a href="https://dom.spec.whatwg.org/#concept-document">https://dom.spec.whatwg.org/#concept-document</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-document">2.5. Processing model</a> <a href="#ref-for-concept-document①">(2)</a> <a href="#ref-for-concept-document②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-event-fire">
   <a href="https://dom.spec.whatwg.org/#concept-event-fire">https://dom.spec.whatwg.org/#concept-event-fire</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-event-fire">3. Prerendering browsing contexts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-node-document">
   <a href="https://dom.spec.whatwg.org/#concept-node-document">https://dom.spec.whatwg.org/#concept-node-document</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-node-document">1. Link type "prerender"</a> <a href="#ref-for-concept-node-document①">(2)</a> <a href="#ref-for-concept-node-document②">(3)</a> <a href="#ref-for-concept-node-document③">(4)</a>
    <li><a href="#ref-for-concept-node-document④">2.3. Prepare a script</a>
    <li><a href="#ref-for-concept-node-document⑤">3. Prerendering browsing contexts</a>
    <li><a href="#ref-for-concept-node-document⑥">6.1. Downloading resources</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-node">
   <a href="https://dom.spec.whatwg.org/#concept-node">https://dom.spec.whatwg.org/#concept-node</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-node">3. Prerendering browsing contexts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-document-origin">
   <a href="https://dom.spec.whatwg.org/#concept-document-origin">https://dom.spec.whatwg.org/#concept-document-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-document-origin">1. Link type "prerender"</a>
    <li><a href="#ref-for-concept-document-origin①">3. Prerendering browsing contexts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request-current-url">
   <a href="https://fetch.spec.whatwg.org/#concept-request-current-url">https://fetch.spec.whatwg.org/#concept-request-current-url</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request-current-url">4.4. Preventing non-HTTP(S) navigations</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-fetch">
   <a href="https://fetch.spec.whatwg.org/#concept-fetch">https://fetch.spec.whatwg.org/#concept-fetch</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-fetch">3. Prerendering browsing contexts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-http-scheme">
   <a href="https://fetch.spec.whatwg.org/#http-scheme">https://fetch.spec.whatwg.org/#http-scheme</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-http-scheme">1. Link type "prerender"</a>
    <li><a href="#ref-for-http-scheme①">2.4. Parsing</a>
    <li><a href="#ref-for-http-scheme②">3. Prerendering browsing contexts</a>
    <li><a href="#ref-for-http-scheme③">4.2. Redirect handling</a>
    <li><a href="#ref-for-http-scheme④">4.4. Preventing non-HTTP(S) navigations</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-response-location-url">
   <a href="https://fetch.spec.whatwg.org/#concept-response-location-url">https://fetch.spec.whatwg.org/#concept-response-location-url</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-response-location-url">4.2. Redirect handling</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request-method">
   <a href="https://fetch.spec.whatwg.org/#concept-request-method">https://fetch.spec.whatwg.org/#concept-request-method</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request-method">4.1. Allowing activation in place of navigation</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-network-error">
   <a href="https://fetch.spec.whatwg.org/#concept-network-error">https://fetch.spec.whatwg.org/#concept-network-error</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-network-error">4.2. Redirect handling</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request-referrer-policy">
   <a href="https://fetch.spec.whatwg.org/#concept-request-referrer-policy">https://fetch.spec.whatwg.org/#concept-request-referrer-policy</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request-referrer-policy">3. Prerendering browsing contexts</a>
    <li><a href="#ref-for-concept-request-referrer-policy①">4.1. Allowing activation in place of navigation</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request">
   <a href="https://fetch.spec.whatwg.org/#concept-request">https://fetch.spec.whatwg.org/#concept-request</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request">3. Prerendering browsing contexts</a>
    <li><a href="#ref-for-concept-request①">4.1. Allowing activation in place of navigation</a> <a href="#ref-for-concept-request②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-response-status">
   <a href="https://fetch.spec.whatwg.org/#concept-response-status">https://fetch.spec.whatwg.org/#concept-response-status</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-response-status">4.4. Preventing non-HTTP(S) navigations</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request-url">
   <a href="https://fetch.spec.whatwg.org/#concept-request-url">https://fetch.spec.whatwg.org/#concept-request-url</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request-url">3. Prerendering browsing contexts</a>
    <li><a href="#ref-for-concept-request-url①">4.1. Allowing activation in place of navigation</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-window-showdirectorypicker">
   <a href="https://wicg.github.io/file-system-access/#dom-window-showdirectorypicker">https://wicg.github.io/file-system-access/#dom-window-showdirectorypicker</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-window-showdirectorypicker">6.3.6. Activation-gated APIs</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-window-showopenfilepicker">
   <a href="https://wicg.github.io/file-system-access/#dom-window-showopenfilepicker">https://wicg.github.io/file-system-access/#dom-window-showopenfilepicker</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-window-showopenfilepicker">6.3.6. Activation-gated APIs</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-window-showsavefilepicker">
   <a href="https://wicg.github.io/file-system-access/#dom-window-showsavefilepicker">https://wicg.github.io/file-system-access/#dom-window-showsavefilepicker</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-window-showsavefilepicker">6.3.6. Activation-gated APIs</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-element-requestfullscreen">
   <a href="https://fullscreen.spec.whatwg.org/#dom-element-requestfullscreen">https://fullscreen.spec.whatwg.org/#dom-element-requestfullscreen</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-element-requestfullscreen">6.3.6. Activation-gated APIs</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-clearwatch-method">
   <a href="https://w3c.github.io/geolocation-api/#clearwatch-method">https://w3c.github.io/geolocation-api/#clearwatch-method</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-clearwatch-method">6.3.1. Geolocation API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-getcurrentposition-method">
   <a href="https://w3c.github.io/geolocation-api/#getcurrentposition-method">https://w3c.github.io/geolocation-api/#getcurrentposition-method</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-getcurrentposition-method">6.3.1. Geolocation API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dfn-watch-process">
   <a href="https://w3c.github.io/geolocation-api/#dfn-watch-process">https://w3c.github.io/geolocation-api/#dfn-watch-process</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-watch-process">6.3.1. Geolocation API</a> <a href="#ref-for-dfn-watch-process①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-watchposition-method">
   <a href="https://w3c.github.io/geolocation-api/#watchposition-method">https://w3c.github.io/geolocation-api/#watchposition-method</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-watchposition-method">6.3.1. Geolocation API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-manipulation-task-source">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source">https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-manipulation-task-source">2.5. Processing model</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dedicatedworkerglobalscope">
   <a href="https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope">https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dedicatedworkerglobalscope">6.3.2. Web Serial API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-eventhandler">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-eventhandler">3. Prerendering browsing contexts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-window">
   <a href="https://html.spec.whatwg.org/multipage/window-object.html#window">https://html.spec.whatwg.org/multipage/window-object.html#window</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-window">3. Prerendering browsing contexts</a>
    <li><a href="#ref-for-window①">6.2. User prompts</a>
    <li><a href="#ref-for-window②">6.3.2. Web Serial API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-abort-a-document">
   <a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#abort-a-document">https://html.spec.whatwg.org/multipage/browsing-the-web.html#abort-a-document</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-abort-a-document">3. Prerendering browsing contexts</a> <a href="#ref-for-abort-a-document①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-active-document">
   <a href="https://html.spec.whatwg.org/multipage/browsers.html#active-document">https://html.spec.whatwg.org/multipage/browsers.html#active-document</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-active-document">3. Prerendering browsing contexts</a> <a href="#ref-for-active-document①">(2)</a> <a href="#ref-for-active-document②">(3)</a> <a href="#ref-for-active-document③">(4)</a> <a href="#ref-for-active-document④">(5)</a>
    <li><a href="#ref-for-active-document⑤">4.1. Allowing activation in place of navigation</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-active-window">
   <a href="https://html.spec.whatwg.org/multipage/browsers.html#active-window">https://html.spec.whatwg.org/multipage/browsers.html#active-window</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-active-window">3. Prerendering browsing contexts</a>
    <li><a href="#ref-for-active-window①">6.3.6. Activation-gated APIs</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-document-window">
   <a href="https://html.spec.whatwg.org/multipage/window-object.html#concept-document-window">https://html.spec.whatwg.org/multipage/window-object.html#concept-document-window</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-document-window">3. Prerendering browsing contexts</a>
    <li><a href="#ref-for-concept-document-window①">6.3.2. Web Serial API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-auxiliary-browsing-context">
   <a href="https://html.spec.whatwg.org/multipage/browsers.html#auxiliary-browsing-context">https://html.spec.whatwg.org/multipage/browsers.html#auxiliary-browsing-context</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-auxiliary-browsing-context">5.1. APIs for creating and navigating browsing contexts by name</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-becomes-browsing-context-connected">
   <a href="https://html.spec.whatwg.org/multipage/infrastructure.html#becomes-browsing-context-connected">https://html.spec.whatwg.org/multipage/infrastructure.html#becomes-browsing-context-connected</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-becomes-browsing-context-connected">1. Link type "prerender"</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-event-beforeunload">
   <a href="https://html.spec.whatwg.org/multipage/indices.html#event-beforeunload">https://html.spec.whatwg.org/multipage/indices.html#event-beforeunload</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-event-beforeunload">6.3.6. Activation-gated APIs</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-body-ok">
   <a href="https://html.spec.whatwg.org/multipage/links.html#body-ok">https://html.spec.whatwg.org/multipage/links.html#body-ok</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-body-ok">1. Link type "prerender"</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-window-bc">
   <a href="https://html.spec.whatwg.org/multipage/window-object.html#window-bc">https://html.spec.whatwg.org/multipage/window-object.html#window-bc</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-window-bc">6.2. User prompts</a> <a href="#ref-for-window-bc①">(2)</a>
    <li><a href="#ref-for-window-bc②">6.3.1. Geolocation API</a> <a href="#ref-for-window-bc③">(2)</a> <a href="#ref-for-window-bc④">(3)</a>
    <li><a href="#ref-for-window-bc⑤">6.3.2. Web Serial API</a>
    <li><a href="#ref-for-window-bc⑥">6.3.3. Notifications API</a>
    <li><a href="#ref-for-window-bc⑦">6.3.4. Web MIDI API</a>
    <li><a href="#ref-for-window-bc⑧">6.3.5. Idle Detection API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-browsing-context-connected">
   <a href="https://html.spec.whatwg.org/multipage/infrastructure.html#browsing-context-connected">https://html.spec.whatwg.org/multipage/infrastructure.html#browsing-context-connected</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-browsing-context-connected">1. Link type "prerender"</a> <a href="#ref-for-browsing-context-connected①">(2)</a> <a href="#ref-for-browsing-context-connected②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-cannot-show-simple-dialogs">
   <a href="https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#cannot-show-simple-dialogs">https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#cannot-show-simple-dialogs</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-cannot-show-simple-dialogs">6.2. User prompts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-initialise-the-document-object">
   <a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#initialise-the-document-object">https://html.spec.whatwg.org/multipage/browsing-the-web.html#initialise-the-document-object</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-initialise-the-document-object">3. Prerendering browsing contexts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-creating-a-new-top-level-browsing-context">
   <a href="https://html.spec.whatwg.org/multipage/browsers.html#creating-a-new-top-level-browsing-context">https://html.spec.whatwg.org/multipage/browsers.html#creating-a-new-top-level-browsing-context</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-creating-a-new-top-level-browsing-context">3. Prerendering browsing contexts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-delay-the-load-event">
   <a href="https://html.spec.whatwg.org/multipage/parsing.html#delay-the-load-event">https://html.spec.whatwg.org/multipage/parsing.html#delay-the-load-event</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-delay-the-load-event">1. Link type "prerender"</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-discard-a-document">
   <a href="https://html.spec.whatwg.org/multipage/window-object.html#discard-a-document">https://html.spec.whatwg.org/multipage/window-object.html#discard-a-document</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-discard-a-document">4.5. Cleanup upon discarding a Document</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-she-document">
   <a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#she-document">https://html.spec.whatwg.org/multipage/browsing-the-web.html#she-document</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-she-document">4.3. Maintaining a trivial session history</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-downloading-hyperlinks">
   <a href="https://html.spec.whatwg.org/multipage/links.html#downloading-hyperlinks">https://html.spec.whatwg.org/multipage/links.html#downloading-hyperlinks</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-downloading-hyperlinks">6.1. Downloading resources</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-environment-discarding-steps">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-discarding-steps">https://html.spec.whatwg.org/multipage/webappapis.html#environment-discarding-steps</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-environment-discarding-steps">4.4. Preventing non-HTTP(S) navigations</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-event-error">
   <a href="https://html.spec.whatwg.org/multipage/indices.html#event-error">https://html.spec.whatwg.org/multipage/indices.html#event-error</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-event-error">1. Link type "prerender"</a>
    <li><a href="#ref-for-event-error①">2.2. The script element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-event-handler-event-type">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type">https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-event-handler-event-type">3. Prerendering browsing contexts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-event-handler-idl-attributes">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes">https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-event-handler-idl-attributes">3. Prerendering browsing contexts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-execute-the-script-block">
   <a href="https://html.spec.whatwg.org/multipage/scripting.html#execute-the-script-block">https://html.spec.whatwg.org/multipage/scripting.html#execute-the-script-block</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-execute-the-script-block">2.2. The script element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-external-resource-link">
   <a href="https://html.spec.whatwg.org/multipage/links.html#external-resource-link">https://html.spec.whatwg.org/multipage/links.html#external-resource-link</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-external-resource-link">1. Link type "prerender"</a> <a href="#ref-for-external-resource-link①">(2)</a> <a href="#ref-for-external-resource-link②">(3)</a> <a href="#ref-for-external-resource-link③">(4)</a> <a href="#ref-for-external-resource-link④">(5)</a> <a href="#ref-for-external-resource-link⑤">(6)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-fetch-and-process-the-linked-resource">
   <a href="https://html.spec.whatwg.org/multipage/semantics.html#fetch-and-process-the-linked-resource">https://html.spec.whatwg.org/multipage/semantics.html#fetch-and-process-the-linked-resource</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-fetch-and-process-the-linked-resource">1. Link type "prerender"</a> <a href="#ref-for-fetch-and-process-the-linked-resource①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-fully-active">
   <a href="https://html.spec.whatwg.org/multipage/browsers.html#fully-active">https://html.spec.whatwg.org/multipage/browsers.html#fully-active</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-fully-active">2.5. Processing model</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-history-handling-behavior">
   <a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#history-handling-behavior">https://html.spec.whatwg.org/multipage/browsing-the-web.html#history-handling-behavior</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-history-handling-behavior">3. Prerendering browsing contexts</a>
    <li><a href="#ref-for-history-handling-behavior①">4.1. Allowing activation in place of navigation</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-attr-link-href">
   <a href="https://html.spec.whatwg.org/multipage/semantics.html#attr-link-href">https://html.spec.whatwg.org/multipage/semantics.html#attr-link-href</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-attr-link-href">1. Link type "prerender"</a> <a href="#ref-for-attr-link-href①">(2)</a> <a href="#ref-for-attr-link-href②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-in-parallel">
   <a href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel">https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-in-parallel">3. Prerendering browsing contexts</a>
    <li><a href="#ref-for-in-parallel①">6.1. Downloading resources</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-the-link-element">
   <a href="https://html.spec.whatwg.org/multipage/semantics.html#the-link-element">https://html.spec.whatwg.org/multipage/semantics.html#the-link-element</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-the-link-element">1. Link type "prerender"</a> <a href="#ref-for-the-link-element①">(2)</a> <a href="#ref-for-the-link-element②">(3)</a> <a href="#ref-for-the-link-element③">(4)</a> <a href="#ref-for-the-link-element④">(5)</a> <a href="#ref-for-the-link-element⑤">(6)</a> <a href="#ref-for-the-link-element⑥">(7)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-event-load">
   <a href="https://html.spec.whatwg.org/multipage/indices.html#event-load">https://html.spec.whatwg.org/multipage/indices.html#event-load</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-event-load">1. Link type "prerender"</a>
    <li><a href="#ref-for-event-load①">2.2. The script element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-navigate-mature">
   <a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#concept-navigate-mature">https://html.spec.whatwg.org/multipage/browsing-the-web.html#concept-navigate-mature</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-navigate-mature">3. Prerendering browsing contexts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-navigate">
   <a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate">https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-navigate">3. Prerendering browsing contexts</a> <a href="#ref-for-navigate①">(2)</a>
    <li><a href="#ref-for-navigate②">4.1. Allowing activation in place of navigation</a> <a href="#ref-for-navigate③">(2)</a>
    <li><a href="#ref-for-navigate④">4.3. Maintaining a trivial session history</a>
    <li><a href="#ref-for-navigate⑤">4.4. Preventing non-HTTP(S) navigations</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-nested-browsing-context">
   <a href="https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context">https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-nested-browsing-context">3. Prerendering browsing contexts</a> <a href="#ref-for-nested-browsing-context①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-networking-task-source">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#networking-task-source">https://html.spec.whatwg.org/multipage/webappapis.html#networking-task-source</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-networking-task-source">3. Prerendering browsing contexts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-document-open-window">
   <a href="https://html.spec.whatwg.org/multipage/dynamic-markup-insertion.html#dom-document-open-window">https://html.spec.whatwg.org/multipage/dynamic-markup-insertion.html#dom-document-open-window</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-document-open-window">6.3.6. Activation-gated APIs</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-parse-a-url">
   <a href="https://html.spec.whatwg.org/multipage/urls-and-fetching.html#parse-a-url">https://html.spec.whatwg.org/multipage/urls-and-fetching.html#parse-a-url</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-parse-a-url">1. Link type "prerender"</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-prepare-a-script">
   <a href="https://html.spec.whatwg.org/multipage/scripting.html#prepare-a-script">https://html.spec.whatwg.org/multipage/scripting.html#prepare-a-script</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-prepare-a-script">2.2. The script element</a>
    <li><a href="#ref-for-prepare-a-script①">2.3. Prepare a script</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-print">
   <a href="https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#dom-print">https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#dom-print</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-print">6.2. User prompts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-process-a-navigate-fetch">
   <a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#process-a-navigate-fetch">https://html.spec.whatwg.org/multipage/browsing-the-web.html#process-a-navigate-fetch</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-process-a-navigate-fetch">4.2. Redirect handling</a> <a href="#ref-for-process-a-navigate-fetch①">(2)</a> <a href="#ref-for-process-a-navigate-fetch②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-process-a-navigate-response">
   <a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#process-a-navigate-response">https://html.spec.whatwg.org/multipage/browsing-the-web.html#process-a-navigate-response</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-process-a-navigate-response">4.4. Preventing non-HTTP(S) navigations</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-process-a-navigate-url-scheme">
   <a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#process-a-navigate-url-scheme">https://html.spec.whatwg.org/multipage/browsing-the-web.html#process-a-navigate-url-scheme</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-process-a-navigate-url-scheme">4.4. Preventing non-HTTP(S) navigations</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-prompt-to-unload-a-document">
   <a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#prompt-to-unload-a-document">https://html.spec.whatwg.org/multipage/browsing-the-web.html#prompt-to-unload-a-document</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-prompt-to-unload-a-document">3. Prerendering browsing contexts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-queue-a-global-task">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task">https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-queue-a-global-task">2.5. Processing model</a>
    <li><a href="#ref-for-queue-a-global-task①">3. Prerendering browsing contexts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-attr-link-referrerpolicy">
   <a href="https://html.spec.whatwg.org/multipage/semantics.html#attr-link-referrerpolicy">https://html.spec.whatwg.org/multipage/semantics.html#attr-link-referrerpolicy</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-attr-link-referrerpolicy">1. Link type "prerender"</a> <a href="#ref-for-attr-link-referrerpolicy①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-refused-to-allow-the-document-to-be-unloaded">
   <a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#refused-to-allow-the-document-to-be-unloaded">https://html.spec.whatwg.org/multipage/browsing-the-web.html#refused-to-allow-the-document-to-be-unloaded</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-refused-to-allow-the-document-to-be-unloaded">3. Prerendering browsing contexts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-relevant-global">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global">https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-relevant-global">2.5. Processing model</a>
    <li><a href="#ref-for-concept-relevant-global①">3. Prerendering browsing contexts</a> <a href="#ref-for-concept-relevant-global②">(2)</a>
    <li><a href="#ref-for-concept-relevant-global③">6.3.1. Geolocation API</a> <a href="#ref-for-concept-relevant-global④">(2)</a> <a href="#ref-for-concept-relevant-global⑤">(3)</a>
    <li><a href="#ref-for-concept-relevant-global⑥">6.3.2. Web Serial API</a> <a href="#ref-for-concept-relevant-global⑦">(2)</a> <a href="#ref-for-concept-relevant-global⑧">(3)</a> <a href="#ref-for-concept-relevant-global⑨">(4)</a> <a href="#ref-for-concept-relevant-global①⓪">(5)</a>
    <li><a href="#ref-for-concept-relevant-global①①">6.3.3. Notifications API</a>
    <li><a href="#ref-for-concept-relevant-global①②">6.3.4. Web MIDI API</a>
    <li><a href="#ref-for-concept-relevant-global①③">6.3.5. Idle Detection API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-navigation-params-request">
   <a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params-request">https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params-request</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-navigation-params-request">4.4. Preventing non-HTTP(S) navigations</a> <a href="#ref-for-navigation-params-request①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-navigation-params-reserved-environment">
   <a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params-reserved-environment">https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params-reserved-environment</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-navigation-params-reserved-environment">4.4. Preventing non-HTTP(S) navigations</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-resulting-url-record">
   <a href="https://html.spec.whatwg.org/multipage/urls-and-fetching.html#resulting-url-record">https://html.spec.whatwg.org/multipage/urls-and-fetching.html#resulting-url-record</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-resulting-url-record">1. Link type "prerender"</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-same-origin">
   <a href="https://html.spec.whatwg.org/multipage/origin.html#same-origin">https://html.spec.whatwg.org/multipage/origin.html#same-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-same-origin">1. Link type "prerender"</a>
    <li><a href="#ref-for-same-origin①">3. Prerendering browsing contexts</a>
    <li><a href="#ref-for-same-origin②">4.2. Redirect handling</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-script">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-script">https://html.spec.whatwg.org/multipage/webappapis.html#concept-script</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-script">2.2. The script element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-script-closable">
   <a href="https://html.spec.whatwg.org/multipage/window-object.html#script-closable">https://html.spec.whatwg.org/multipage/window-object.html#script-closable</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-script-closable">5.1. APIs for creating and navigating browsing contexts by name</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-session-history">
   <a href="https://html.spec.whatwg.org/multipage/history.html#session-history">https://html.spec.whatwg.org/multipage/history.html#session-history</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-session-history">3. Prerendering browsing contexts</a>
    <li><a href="#ref-for-session-history①">4.3. Maintaining a trivial session history</a>
    <li><a href="#ref-for-session-history②">5.1. APIs for creating and navigating browsing contexts by name</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-source-browsing-context">
   <a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#source-browsing-context">https://html.spec.whatwg.org/multipage/browsing-the-web.html#source-browsing-context</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-source-browsing-context">3. Prerendering browsing contexts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-script-src">
   <a href="https://html.spec.whatwg.org/multipage/scripting.html#dom-script-src">https://html.spec.whatwg.org/multipage/scripting.html#dom-script-src</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-script-src">2.2. The script element</a>
    <li><a href="#ref-for-dom-script-src①">2.3. Prepare a script</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-sticky-activation">
   <a href="https://html.spec.whatwg.org/multipage/interaction.html#sticky-activation">https://html.spec.whatwg.org/multipage/interaction.html#sticky-activation</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sticky-activation">6.3.6. Activation-gated APIs</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-the-script-is-ready">
   <a href="https://html.spec.whatwg.org/multipage/scripting.html#the-script-is-ready">https://html.spec.whatwg.org/multipage/scripting.html#the-script-is-ready</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-the-script-is-ready">2.3. Prepare a script</a> <a href="#ref-for-the-script-is-ready①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-script-script">
   <a href="https://html.spec.whatwg.org/multipage/scripting.html#concept-script-script">https://html.spec.whatwg.org/multipage/scripting.html#concept-script-script</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-script-script">2.2. The script element</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-script-type">
   <a href="https://html.spec.whatwg.org/multipage/scripting.html#concept-script-type">https://html.spec.whatwg.org/multipage/scripting.html#concept-script-type</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-script-type">2.2. The script element</a> <a href="#ref-for-concept-script-type①">(2)</a>
    <li><a href="#ref-for-concept-script-type②">2.3. Prepare a script</a> <a href="#ref-for-concept-script-type③">(2)</a> <a href="#ref-for-concept-script-type④">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-top-level-browsing-context">
   <a href="https://html.spec.whatwg.org/multipage/browsers.html#top-level-browsing-context">https://html.spec.whatwg.org/multipage/browsers.html#top-level-browsing-context</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-top-level-browsing-context">3. Prerendering browsing contexts</a> <a href="#ref-for-top-level-browsing-context①">(2)</a> <a href="#ref-for-top-level-browsing-context②">(3)</a>
    <li><a href="#ref-for-top-level-browsing-context③">4.1. Allowing activation in place of navigation</a>
    <li><a href="#ref-for-top-level-browsing-context④">5. Preventing nonsensical behaviors</a>
    <li><a href="#ref-for-top-level-browsing-context⑤">5.1. APIs for creating and navigating browsing contexts by name</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-transient-activation">
   <a href="https://html.spec.whatwg.org/multipage/interaction.html#transient-activation">https://html.spec.whatwg.org/multipage/interaction.html#transient-activation</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-transient-activation">6.3.5. Idle Detection API</a>
    <li><a href="#ref-for-transient-activation①">6.3.6. Activation-gated APIs</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-traverse-the-history">
   <a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#traverse-the-history">https://html.spec.whatwg.org/multipage/browsing-the-web.html#traverse-the-history</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-traverse-the-history">4.3. Maintaining a trivial session history</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-url-and-history-update-steps">
   <a href="https://html.spec.whatwg.org/multipage/history.html#url-and-history-update-steps">https://html.spec.whatwg.org/multipage/history.html#url-and-history-update-steps</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-url-and-history-update-steps">4.3. Maintaining a trivial session history</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-api-idledetector-requestpermission">
   <a href="https://wicg.github.io/idle-detection/#api-idledetector-requestpermission">https://wicg.github.io/idle-detection/#api-idledetector-requestpermission</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-api-idledetector-requestpermission">6.3.5. Idle Detection API</a>
    <li><a href="#ref-for-api-idledetector-requestpermission①">6.3.6. Activation-gated APIs</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-api-idledetector-start">
   <a href="https://wicg.github.io/idle-detection/#api-idledetector-start">https://wicg.github.io/idle-detection/#api-idledetector-start</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-api-idledetector-start">6.3.5. Idle Detection API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-set-append">
   <a href="https://infra.spec.whatwg.org/#set-append">https://infra.spec.whatwg.org/#set-append</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-set-append">2.4. Parsing</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-ascii-case-insensitive">
   <a href="https://infra.spec.whatwg.org/#ascii-case-insensitive">https://infra.spec.whatwg.org/#ascii-case-insensitive</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-ascii-case-insensitive">2.3. Prepare a script</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-assert">
   <a href="https://infra.spec.whatwg.org/#assert">https://infra.spec.whatwg.org/#assert</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-assert">2.2. The script element</a>
    <li><a href="#ref-for-assert①">3. Prerendering browsing contexts</a> <a href="#ref-for-assert②">(2)</a>
    <li><a href="#ref-for-assert③">4.2. Redirect handling</a> <a href="#ref-for-assert④">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-iteration-break">
   <a href="https://infra.spec.whatwg.org/#iteration-break">https://infra.spec.whatwg.org/#iteration-break</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-iteration-break">4.2. Redirect handling</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-list-contain">
   <a href="https://infra.spec.whatwg.org/#list-contain">https://infra.spec.whatwg.org/#list-contain</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-list-contain">1. Link type "prerender"</a>
    <li><a href="#ref-for-list-contain①">2.5. Processing model</a> <a href="#ref-for-list-contain②">(2)</a>
    <li><a href="#ref-for-list-contain③">3. Prerendering browsing contexts</a>
    <li><a href="#ref-for-list-contain④">4.2. Redirect handling</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-iteration-continue">
   <a href="https://infra.spec.whatwg.org/#iteration-continue">https://infra.spec.whatwg.org/#iteration-continue</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-iteration-continue">2.4. Parsing</a> <a href="#ref-for-iteration-continue①">(2)</a> <a href="#ref-for-iteration-continue②">(3)</a> <a href="#ref-for-iteration-continue③">(4)</a> <a href="#ref-for-iteration-continue④">(5)</a> <a href="#ref-for-iteration-continue⑤">(6)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-list-empty">
   <a href="https://infra.spec.whatwg.org/#list-empty">https://infra.spec.whatwg.org/#list-empty</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-list-empty">3. Prerendering browsing contexts</a>
    <li><a href="#ref-for-list-empty①">4.5. Cleanup upon discarding a Document</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-map-exists">
   <a href="https://infra.spec.whatwg.org/#map-exists">https://infra.spec.whatwg.org/#map-exists</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-map-exists">2.4. Parsing</a> <a href="#ref-for-map-exists①">(2)</a> <a href="#ref-for-map-exists②">(3)</a> <a href="#ref-for-map-exists③">(4)</a> <a href="#ref-for-map-exists④">(5)</a>
    <li><a href="#ref-for-map-exists⑤">3. Prerendering browsing contexts</a>
    <li><a href="#ref-for-map-exists⑥">4.1. Allowing activation in place of navigation</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-list-iterate">
   <a href="https://infra.spec.whatwg.org/#list-iterate">https://infra.spec.whatwg.org/#list-iterate</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-list-iterate">2.4. Parsing</a> <a href="#ref-for-list-iterate①">(2)</a> <a href="#ref-for-list-iterate②">(3)</a> <a href="#ref-for-list-iterate③">(4)</a>
    <li><a href="#ref-for-list-iterate④">2.5. Processing model</a> <a href="#ref-for-list-iterate⑤">(2)</a> <a href="#ref-for-list-iterate⑥">(3)</a> <a href="#ref-for-list-iterate⑦">(4)</a>
    <li><a href="#ref-for-list-iterate⑧">3. Prerendering browsing contexts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-struct-item">
   <a href="https://infra.spec.whatwg.org/#struct-item">https://infra.spec.whatwg.org/#struct-item</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-struct-item">2.1. Definitions</a> <a href="#ref-for-struct-item①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-map-key">
   <a href="https://infra.spec.whatwg.org/#map-key">https://infra.spec.whatwg.org/#map-key</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-map-key">2.4. Parsing</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-list">
   <a href="https://infra.spec.whatwg.org/#list">https://infra.spec.whatwg.org/#list</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-list">1. Link type "prerender"</a>
    <li><a href="#ref-for-list①">2.1. Definitions</a> <a href="#ref-for-list②">(2)</a>
    <li><a href="#ref-for-list③">2.4. Parsing</a> <a href="#ref-for-list④">(2)</a> <a href="#ref-for-list⑤">(3)</a> <a href="#ref-for-list⑥">(4)</a> <a href="#ref-for-list⑦">(5)</a>
    <li><a href="#ref-for-list⑧">2.5. Processing model</a>
    <li><a href="#ref-for-list⑨">3. Prerendering browsing contexts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-ordered-map">
   <a href="https://infra.spec.whatwg.org/#ordered-map">https://infra.spec.whatwg.org/#ordered-map</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-ordered-map">2.4. Parsing</a> <a href="#ref-for-ordered-map①">(2)</a> <a href="#ref-for-ordered-map②">(3)</a> <a href="#ref-for-ordered-map③">(4)</a>
    <li><a href="#ref-for-ordered-map④">3. Prerendering browsing contexts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-ordered-map">
   <a href="https://infra.spec.whatwg.org/#ordered-map">https://infra.spec.whatwg.org/#ordered-map</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-ordered-map">2.4. Parsing</a> <a href="#ref-for-ordered-map①">(2)</a> <a href="#ref-for-ordered-map②">(3)</a> <a href="#ref-for-ordered-map③">(4)</a>
    <li><a href="#ref-for-ordered-map④">3. Prerendering browsing contexts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-ordered-set">
   <a href="https://infra.spec.whatwg.org/#ordered-set">https://infra.spec.whatwg.org/#ordered-set</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-ordered-set">2.1. Definitions</a> <a href="#ref-for-ordered-set①">(2)</a>
    <li><a href="#ref-for-ordered-set②">2.4. Parsing</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-parse-a-json-string-to-an-infra-value">
   <a href="https://infra.spec.whatwg.org/#parse-a-json-string-to-an-infra-value">https://infra.spec.whatwg.org/#parse-a-json-string-to-an-infra-value</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-parse-a-json-string-to-an-infra-value">2.4. Parsing</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-string">
   <a href="https://infra.spec.whatwg.org/#string">https://infra.spec.whatwg.org/#string</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-string">2.1. Definitions</a>
    <li><a href="#ref-for-string①">2.4. Parsing</a> <a href="#ref-for-string②">(2)</a> <a href="#ref-for-string③">(3)</a> <a href="#ref-for-string④">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-struct">
   <a href="https://infra.spec.whatwg.org/#struct">https://infra.spec.whatwg.org/#struct</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-struct">2.1. Definitions</a> <a href="#ref-for-struct①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-tuple">
   <a href="https://infra.spec.whatwg.org/#tuple">https://infra.spec.whatwg.org/#tuple</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-tuple">3. Prerendering browsing contexts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-notification-requestpermission">
   <a href="https://notifications.spec.whatwg.org/#dom-notification-requestpermission">https://notifications.spec.whatwg.org/#dom-notification-requestpermission</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-notification-requestpermission">6.3.3. Notifications API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-paymentrequest-show">
   <a href="https://www.w3.org/TR/payment-request/#dom-paymentrequest-show">https://www.w3.org/TR/payment-request/#dom-paymentrequest-show</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-paymentrequest-show">6.3.6. Activation-gated APIs</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-presentationrequest-start">
   <a href="https://w3c.github.io/presentation-api/#dom-presentationrequest-start">https://w3c.github.io/presentation-api/#dom-presentationrequest-start</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-presentationrequest-start">6.3.6. Activation-gated APIs</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-referrer-policy">
   <a href="https://w3c.github.io/webappsec-referrer-policy/#referrer-policy">https://w3c.github.io/webappsec-referrer-policy/#referrer-policy</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-referrer-policy">1. Link type "prerender"</a>
    <li><a href="#ref-for-referrer-policy①">3. Prerendering browsing contexts</a> <a href="#ref-for-referrer-policy②">(2)</a>
    <li><a href="#ref-for-referrer-policy③">4.2. Redirect handling</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-serial-getports">
   <a href="https://wicg.github.io/serial/#dom-serial-getports">https://wicg.github.io/serial/#dom-serial-getports</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-serial-getports">6.3.2. Web Serial API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-serial-requestPort">
   <a href="https://wicg.github.io/serial/#dom-serial-requestPort">https://wicg.github.io/serial/#dom-serial-requestPort</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-serial-requestPort">6.3.2. Web Serial API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-basic-url-parser">
   <a href="https://url.spec.whatwg.org/#concept-basic-url-parser">https://url.spec.whatwg.org/#concept-basic-url-parser</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-basic-url-parser">2.4. Parsing</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-url-origin">
   <a href="https://url.spec.whatwg.org/#concept-url-origin">https://url.spec.whatwg.org/#concept-url-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-url-origin">1. Link type "prerender"</a>
    <li><a href="#ref-for-concept-url-origin①">3. Prerendering browsing contexts</a>
    <li><a href="#ref-for-concept-url-origin②">4.2. Redirect handling</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-url-scheme">
   <a href="https://url.spec.whatwg.org/#concept-url-scheme">https://url.spec.whatwg.org/#concept-url-scheme</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-url-scheme">1. Link type "prerender"</a>
    <li><a href="#ref-for-concept-url-scheme①">2.4. Parsing</a>
    <li><a href="#ref-for-concept-url-scheme②">3. Prerendering browsing contexts</a>
    <li><a href="#ref-for-concept-url-scheme③">4.2. Redirect handling</a>
    <li><a href="#ref-for-concept-url-scheme④">4.4. Preventing non-HTTP(S) navigations</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-url">
   <a href="https://url.spec.whatwg.org/#concept-url">https://url.spec.whatwg.org/#concept-url</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-url">2.1. Definitions</a>
    <li><a href="#ref-for-concept-url①">2.4. Parsing</a> <a href="#ref-for-concept-url②">(2)</a>
    <li><a href="#ref-for-concept-url③">3. Prerendering browsing contexts</a> <a href="#ref-for-concept-url④">(2)</a>
    <li><a href="#ref-for-concept-url⑤">4.2. Redirect handling</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-DOMException">
   <a href="https://heycam.github.io/webidl/#idl-DOMException">https://heycam.github.io/webidl/#idl-DOMException</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-DOMException">6.3.2. Web Serial API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-promise">
   <a href="https://heycam.github.io/webidl/#idl-promise">https://heycam.github.io/webidl/#idl-promise</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-promise">3. Prerendering browsing contexts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-securityerror">
   <a href="https://heycam.github.io/webidl/#securityerror">https://heycam.github.io/webidl/#securityerror</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-securityerror">6.3.2. Web Serial API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-a-promise-rejected-with">
   <a href="https://heycam.github.io/webidl/#a-promise-rejected-with">https://heycam.github.io/webidl/#a-promise-rejected-with</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-a-promise-rejected-with">6.3.2. Web Serial API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-boolean">
   <a href="https://heycam.github.io/webidl/#idl-boolean">https://heycam.github.io/webidl/#idl-boolean</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-boolean">3. Prerendering browsing contexts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-this">
   <a href="https://heycam.github.io/webidl/#this">https://heycam.github.io/webidl/#this</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-this">3. Prerendering browsing contexts</a>
    <li><a href="#ref-for-this①">6.2. User prompts</a>
    <li><a href="#ref-for-this②">6.3.1. Geolocation API</a> <a href="#ref-for-this③">(2)</a> <a href="#ref-for-this④">(3)</a> <a href="#ref-for-this⑤">(4)</a> <a href="#ref-for-this⑥">(5)</a> <a href="#ref-for-this⑦">(6)</a>
    <li><a href="#ref-for-this⑧">6.3.2. Web Serial API</a> <a href="#ref-for-this⑨">(2)</a> <a href="#ref-for-this①⓪">(3)</a> <a href="#ref-for-this①①">(4)</a> <a href="#ref-for-this①②">(5)</a> <a href="#ref-for-this①③">(6)</a>
    <li><a href="#ref-for-this①④">6.3.3. Notifications API</a> <a href="#ref-for-this①⑤">(2)</a>
    <li><a href="#ref-for-this①⑥">6.3.4. Web MIDI API</a> <a href="#ref-for-this①⑦">(2)</a>
    <li><a href="#ref-for-this①⑧">6.3.5. Idle Detection API</a> <a href="#ref-for-this①⑨">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-navigator-requestmidiaccess">
   <a href="https://webaudio.github.io/web-midi-api/#dom-navigator-requestmidiaccess">https://webaudio.github.io/web-midi-api/#dom-navigator-requestmidiaccess</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-navigator-requestmidiaccess">6.3.4. Web MIDI API</a>
   </ul>
  </aside>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-document">Document</span>
     <li><span class="dfn-paneled" id="term-for-concept-document">document</span>
     <li><span class="dfn-paneled" id="term-for-concept-event-fire">fire an event</span>
     <li><span class="dfn-paneled" id="term-for-concept-node-document">node document</span>
     <li><span class="dfn-paneled" id="term-for-concept-node">nodes</span>
     <li><span class="dfn-paneled" id="term-for-concept-document-origin">origin</span>
    </ul>
   <li>
    <a data-link-type="biblio">[FETCH]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-concept-request-current-url">current url</span>
     <li><span class="dfn-paneled" id="term-for-concept-fetch">fetch</span>
     <li><span class="dfn-paneled" id="term-for-http-scheme">http(s) scheme</span>
     <li><span class="dfn-paneled" id="term-for-concept-response-location-url">location url</span>
     <li><span class="dfn-paneled" id="term-for-concept-request-method">method</span>
     <li><span class="dfn-paneled" id="term-for-concept-network-error">network error</span>
     <li><span class="dfn-paneled" id="term-for-concept-request-referrer-policy">referrer policy</span>
     <li><span class="dfn-paneled" id="term-for-concept-request">request</span>
     <li><span class="dfn-paneled" id="term-for-concept-response-status">status</span>
     <li><span class="dfn-paneled" id="term-for-concept-request-url">url</span>
    </ul>
   <li>
    <a data-link-type="biblio">[FILE-SYSTEM-ACCESS]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-dom-window-showdirectorypicker">showDirectoryPicker()</span>
     <li><span class="dfn-paneled" id="term-for-dom-window-showopenfilepicker">showOpenFilePicker()</span>
     <li><span class="dfn-paneled" id="term-for-dom-window-showsavefilepicker">showSaveFilePicker()</span>
    </ul>
   <li>
    <a data-link-type="biblio">[FULLSCREEN]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-dom-element-requestfullscreen">requestFullscreen()</span>
    </ul>
   <li>
    <a data-link-type="biblio">[geolocation]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-clearwatch-method">clearWatch(watchId)</span>
     <li><span class="dfn-paneled" id="term-for-getcurrentposition-method">getCurrentPosition(successCallback, errorCallback, options)</span>
     <li><span class="dfn-paneled" id="term-for-dfn-watch-process">watch process</span>
     <li><span class="dfn-paneled" id="term-for-watchposition-method">watchPosition(successCallback, errorCallback, options)</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-dom-manipulation-task-source">DOM manipulation task source</span>
     <li><span class="dfn-paneled" id="term-for-dedicatedworkerglobalscope">DedicatedWorkerGlobalScope</span>
     <li><span class="dfn-paneled" id="term-for-eventhandler">EventHandler</span>
     <li><span class="dfn-paneled" id="term-for-window">Window</span>
     <li><span class="dfn-paneled" id="term-for-abort-a-document">abort</span>
     <li><span class="dfn-paneled" id="term-for-active-document">active document</span>
     <li><span class="dfn-paneled" id="term-for-active-window">active window</span>
     <li><span class="dfn-paneled" id="term-for-concept-document-window">associated document</span>
     <li><span class="dfn-paneled" id="term-for-auxiliary-browsing-context">auxiliary browsing context</span>
     <li><span class="dfn-paneled" id="term-for-becomes-browsing-context-connected">become browsing-context connected</span>
     <li><span class="dfn-paneled" id="term-for-event-beforeunload">beforeunload</span>
     <li><span class="dfn-paneled" id="term-for-body-ok">body-ok</span>
     <li><span class="dfn-paneled" id="term-for-window-bc">browsing context <small>(for Window)</small></span>
     <li><span class="dfn-paneled" id="term-for-browsing-context-connected">browsing-context connected</span>
     <li><span class="dfn-paneled" id="term-for-cannot-show-simple-dialogs">cannot show simple dialogs</span>
     <li><span class="dfn-paneled" id="term-for-initialise-the-document-object">create and initialize a document object</span>
     <li><span class="dfn-paneled" id="term-for-creating-a-new-top-level-browsing-context">creating a new top-level browsing context</span>
     <li><span class="dfn-paneled" id="term-for-delay-the-load-event">delays the load event</span>
     <li><span class="dfn-paneled" id="term-for-discard-a-document">discard a document</span>
     <li><span class="dfn-paneled" id="term-for-she-document">document</span>
     <li><span class="dfn-paneled" id="term-for-downloading-hyperlinks">downloads a hyperlink</span>
     <li><span class="dfn-paneled" id="term-for-environment-discarding-steps">environment discarding steps</span>
     <li><span class="dfn-paneled" id="term-for-event-error">error</span>
     <li><span class="dfn-paneled" id="term-for-event-handler-event-type">event handler event type</span>
     <li><span class="dfn-paneled" id="term-for-event-handler-idl-attributes">event handler idl attribute</span>
     <li><span class="dfn-paneled" id="term-for-execute-the-script-block">execute a script block</span>
     <li><span class="dfn-paneled" id="term-for-external-resource-link">external resource link</span>
     <li><span class="dfn-paneled" id="term-for-fetch-and-process-the-linked-resource">fetch and process the linked resource</span>
     <li><span class="dfn-paneled" id="term-for-fully-active">fully active</span>
     <li><span class="dfn-paneled" id="term-for-history-handling-behavior">history handling behavior</span>
     <li><span class="dfn-paneled" id="term-for-attr-link-href">href</span>
     <li><span class="dfn-paneled" id="term-for-in-parallel">in parallel</span>
     <li><span class="dfn-paneled" id="term-for-the-link-element">link</span>
     <li><span class="dfn-paneled" id="term-for-event-load">load</span>
     <li><span class="dfn-paneled" id="term-for-concept-navigate-mature">mature</span>
     <li><span class="dfn-paneled" id="term-for-navigate">navigate</span>
     <li><span class="dfn-paneled" id="term-for-nested-browsing-context">nested browsing context</span>
     <li><span class="dfn-paneled" id="term-for-networking-task-source">networking task source</span>
     <li><span class="dfn-paneled" id="term-for-dom-document-open-window">open(url, name, features)</span>
     <li><span class="dfn-paneled" id="term-for-parse-a-url">parse a url</span>
     <li><span class="dfn-paneled" id="term-for-prepare-a-script">prepare a script</span>
     <li><span class="dfn-paneled" id="term-for-dom-print">print()</span>
     <li><span class="dfn-paneled" id="term-for-process-a-navigate-fetch">process a navigate fetch</span>
     <li><span class="dfn-paneled" id="term-for-process-a-navigate-response">process a navigate response</span>
     <li><span class="dfn-paneled" id="term-for-process-a-navigate-url-scheme">process a navigate url scheme</span>
     <li><span class="dfn-paneled" id="term-for-prompt-to-unload-a-document">prompt to unload</span>
     <li><span class="dfn-paneled" id="term-for-queue-a-global-task">queue a global task</span>
     <li><span class="dfn-paneled" id="term-for-attr-link-referrerpolicy">referrerpolicy</span>
     <li><span class="dfn-paneled" id="term-for-refused-to-allow-the-document-to-be-unloaded">refused to allow the document to be unloaded</span>
     <li><span class="dfn-paneled" id="term-for-concept-relevant-global">relevant global object</span>
     <li><span class="dfn-paneled" id="term-for-navigation-params-request">request</span>
     <li><span class="dfn-paneled" id="term-for-navigation-params-reserved-environment">reserved environment</span>
     <li><span class="dfn-paneled" id="term-for-resulting-url-record">resulting url record</span>
     <li><span class="dfn-paneled" id="term-for-same-origin">same origin</span>
     <li><span class="dfn-paneled" id="term-for-concept-script">script</span>
     <li><span class="dfn-paneled" id="term-for-script-closable">script-closable</span>
     <li><span class="dfn-paneled" id="term-for-session-history">session history</span>
     <li><span class="dfn-paneled" id="term-for-source-browsing-context">source browsing context</span>
     <li><span class="dfn-paneled" id="term-for-dom-script-src">src</span>
     <li><span class="dfn-paneled" id="term-for-sticky-activation">sticky activation</span>
     <li><span class="dfn-paneled" id="term-for-the-script-is-ready">the script is ready</span>
     <li><span class="dfn-paneled" id="term-for-concept-script-script">the script's script</span>
     <li><span class="dfn-paneled" id="term-for-concept-script-type">the script's type</span>
     <li><span class="dfn-paneled" id="term-for-top-level-browsing-context">top-level browsing context</span>
     <li><span class="dfn-paneled" id="term-for-transient-activation">transient activation</span>
     <li><span class="dfn-paneled" id="term-for-traverse-the-history">traverse the history</span>
     <li><span class="dfn-paneled" id="term-for-url-and-history-update-steps">url and history update steps</span>
    </ul>
   <li>
    <a data-link-type="biblio">[IDLE-DETECTION]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-api-idledetector-requestpermission">requestPermission()</span>
     <li><span class="dfn-paneled" id="term-for-api-idledetector-start">start()</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-set-append">append <small>(for set)</small></span>
     <li><span class="dfn-paneled" id="term-for-ascii-case-insensitive">ascii case-insensitive</span>
     <li><span class="dfn-paneled" id="term-for-assert">assert</span>
     <li><span class="dfn-paneled" id="term-for-iteration-break">break</span>
     <li><span class="dfn-paneled" id="term-for-list-contain">contain</span>
     <li><span class="dfn-paneled" id="term-for-iteration-continue">continue</span>
     <li><span class="dfn-paneled" id="term-for-list-empty">empty</span>
     <li><span class="dfn-paneled" id="term-for-map-exists">exist</span>
     <li><span class="dfn-paneled" id="term-for-list-iterate">for each</span>
     <li><span class="dfn-paneled" id="term-for-struct-item">item <small>(for struct)</small></span>
     <li><span class="dfn-paneled" id="term-for-map-key">key</span>
     <li><span class="dfn-paneled" id="term-for-list">list</span>
     <li><span class="dfn-paneled" id="term-for-ordered-map">map</span>
     <li><span class="dfn-paneled" id="term-for-ordered-map①">ordered map</span>
     <li><span class="dfn-paneled" id="term-for-ordered-set">ordered set</span>
     <li><span class="dfn-paneled" id="term-for-parse-a-json-string-to-an-infra-value">parsing a json string to an infra value</span>
     <li><span class="dfn-paneled" id="term-for-string">string</span>
     <li><span class="dfn-paneled" id="term-for-struct">struct</span>
     <li><span class="dfn-paneled" id="term-for-tuple">tuple</span>
    </ul>
   <li>
    <a data-link-type="biblio">[NOTIFICATIONS]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-dom-notification-requestpermission">requestPermission()</span>
    </ul>
   <li>
    <a data-link-type="biblio">[PAYMENT-REQUEST]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-dom-paymentrequest-show">show()</span>
    </ul>
   <li>
    <a data-link-type="biblio">[PRESENTATION-API]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-dom-presentationrequest-start">start()</span>
    </ul>
   <li>
    <a data-link-type="biblio">[referrer-policy]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-referrer-policy">referrer policy</span>
    </ul>
   <li>
    <a data-link-type="biblio">[serial]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-dom-serial-getports">getPorts()</span>
     <li><span class="dfn-paneled" id="term-for-dom-serial-requestPort">requestPort(options)</span>
    </ul>
   <li>
    <a data-link-type="biblio">[URL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-concept-basic-url-parser">basic url parser</span>
     <li><span class="dfn-paneled" id="term-for-concept-url-origin">origin</span>
     <li><span class="dfn-paneled" id="term-for-concept-url-scheme">scheme</span>
     <li><span class="dfn-paneled" id="term-for-concept-url">url</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WebIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-idl-DOMException">DOMException</span>
     <li><span class="dfn-paneled" id="term-for-idl-promise">Promise</span>
     <li><span class="dfn-paneled" id="term-for-securityerror">SecurityError</span>
     <li><span class="dfn-paneled" id="term-for-a-promise-rejected-with">a promise rejected with</span>
     <li><span class="dfn-paneled" id="term-for-idl-boolean">boolean</span>
     <li><span class="dfn-paneled" id="term-for-this">this</span>
    </ul>
   <li>
    <a data-link-type="biblio">[webmidi]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-dom-navigator-requestmidiaccess">requestMIDIAccess()</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/">DOM Standard</a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-fetch">[FETCH]
   <dd>Anne van Kesteren. <a href="https://fetch.spec.whatwg.org/">Fetch Standard</a>. Living Standard. URL: <a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
   <dt id="biblio-file-system-access">[FILE-SYSTEM-ACCESS]
   <dd><a href="https://wicg.github.io/file-system-access/">File System Access</a>. cg-draft. URL: <a href="https://wicg.github.io/file-system-access/">https://wicg.github.io/file-system-access/</a>
   <dt id="biblio-fullscreen">[FULLSCREEN]
   <dd>Philip Jägenstedt. <a href="https://fullscreen.spec.whatwg.org/">Fullscreen API Standard</a>. Living Standard. URL: <a href="https://fullscreen.spec.whatwg.org/">https://fullscreen.spec.whatwg.org/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/">HTML Standard</a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-idle-detection">[IDLE-DETECTION]
   <dd>Reilly Grant. <a href="https://wicg.github.io/idle-detection/">Idle Detection API</a>. CG-DRAFT. URL: <a href="https://wicg.github.io/idle-detection/">https://wicg.github.io/idle-detection/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/">Infra Standard</a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-notifications">[NOTIFICATIONS]
   <dd>Anne van Kesteren. <a href="https://notifications.spec.whatwg.org/">Notifications API Standard</a>. Living Standard. URL: <a href="https://notifications.spec.whatwg.org/">https://notifications.spec.whatwg.org/</a>
   <dt id="biblio-payment-request">[PAYMENT-REQUEST]
   <dd>Marcos Caceres; et al. <a href="https://www.w3.org/TR/payment-request/">Payment Request API</a>. 3 December 2020. CR. URL: <a href="https://www.w3.org/TR/payment-request/">https://www.w3.org/TR/payment-request/</a>
   <dt id="biblio-presentation-api">[PRESENTATION-API]
   <dd>Mark Foltz; Dominik Röttsches. <a href="https://www.w3.org/TR/presentation-api/">Presentation API</a>. 5 November 2020. CR. URL: <a href="https://www.w3.org/TR/presentation-api/">https://www.w3.org/TR/presentation-api/</a>
   <dt id="biblio-referrer-policy">[REFERRER-POLICY]
   <dd>Jochen Eisinger; Emily Stark. <a href="https://www.w3.org/TR/referrer-policy/">Referrer Policy</a>. 26 January 2017. CR. URL: <a href="https://www.w3.org/TR/referrer-policy/">https://www.w3.org/TR/referrer-policy/</a>
   <dt id="biblio-url">[URL]
   <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/">URL Standard</a>. Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
   <dt id="biblio-webidl">[WebIDL]
   <dd>Boris Zbarsky. <a href="https://heycam.github.io/webidl/">Web IDL</a>. 15 December 2016. ED. URL: <a href="https://heycam.github.io/webidl/">https://heycam.github.io/webidl/</a>
   <dt id="biblio-webmidi">[WEBMIDI]
   <dd>Chris Wilson; Jussi Kalliokoski. <a href="https://www.w3.org/TR/webmidi/">Web MIDI API</a>. 17 March 2015. WD. URL: <a href="https://www.w3.org/TR/webmidi/">https://www.w3.org/TR/webmidi/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-resource-hints">[RESOURCE-HINTS]
   <dd>Ilya Grigorik. <a href="https://www.w3.org/TR/resource-hints/">Resource Hints</a>. 5 October 2020. WD. URL: <a href="https://www.w3.org/TR/resource-hints/">https://www.w3.org/TR/resource-hints/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def"><c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://dom.spec.whatwg.org/#document"><c- g>Document</c-></a> {
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-boolean"><c- b>boolean</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="boolean" href="#dom-document-prerendering"><c- g>prerendering</c-></a>;
    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"><c- n>EventHandler</c-></a> <a class="idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-document-onprerenderingchange"><c- g>onprerenderingchange</c-></a>;
};

</pre>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue">We should consider whether we also want to make this execute even if scripting is disabled.<a href="#issue-c2e21e13"> ↵ </a></div>
   <div class="issue">We should also incorporate the case where a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/scripting.html#dom-script-src">src</a></code> attribute is set.<a href="#issue-bb120c28"> ↵ </a></div>
   <div class="issue">We could fire <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/indices.html#event-error">error</a></code> and <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/indices.html#event-load">load</a></code> events if we wanted to.<a href="#issue-9cd39e70"> ↵ </a></div>
   <div class="issue">It’s likely that we should also handle prerendered and back-forward cached documents. <a href="#issue-30bcda38"> ↵ </a></div>
   <div class="issue">TODO: expand this along with prefetch more generally. <a href="#issue-81bee6f0"> ↵ </a></div>
   <div class="issue">TODO: expand this to actually elaborate on how prefetch works, once initiated, and to incorporate the <var>requiresAnonymousClientIPWhenCrossOrigin</var> flag. We may wish to include language about when the UA should deduplicate requests. <a href="#issue-8088bc6e"> ↵ </a></div>
   <div class="issue"> We should also notice removals and consider cancelling speculated actions. <a href="#issue-ba67a3f6"> ↵ </a></div>
   <div class="issue">Probably we will need more loading modes for handling <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context">nested browsing contexts</a> inside of top-level prerendered ones. Definitely a to-do.<a href="#issue-c1bc22a3"> ↵ </a></div>
   <div class="issue">Portals might need an extra hook to close the portal in these cases. Or should we reconsider and just do nothing for portals too? That might be more elegant. I think it just requires portals to not be so zealous about clearing the host element/browsing context link, which isn’t observable anyway? <a href="#issue-755a1cad"> ↵ </a></div>
  </div>
  <aside class="dfn-panel" data-for="attr-valuedef-link-rel-prerender">
   <b><a href="#attr-valuedef-link-rel-prerender">#attr-valuedef-link-rel-prerender</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-attr-valuedef-link-rel-prerender">1. Link type "prerender"</a> <a href="#ref-for-attr-valuedef-link-rel-prerender①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="list-of-sufficiently-strict-speculative-navigation-referrer-policies">
   <b><a href="#list-of-sufficiently-strict-speculative-navigation-referrer-policies">#list-of-sufficiently-strict-speculative-navigation-referrer-policies</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-list-of-sufficiently-strict-speculative-navigation-referrer-policies">1. Link type "prerender"</a>
    <li><a href="#ref-for-list-of-sufficiently-strict-speculative-navigation-referrer-policies①">3. Prerendering browsing contexts</a>
    <li><a href="#ref-for-list-of-sufficiently-strict-speculative-navigation-referrer-policies②">4.2. Redirect handling</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="speculation-rule">
   <b><a href="#speculation-rule">#speculation-rule</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-speculation-rule">2.1. Definitions</a> <a href="#ref-for-speculation-rule①">(2)</a>
    <li><a href="#ref-for-speculation-rule②">2.4. Parsing</a> <a href="#ref-for-speculation-rule③">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="speculation-rule-urls">
   <b><a href="#speculation-rule-urls">#speculation-rule-urls</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-speculation-rule-urls">2.4. Parsing</a>
    <li><a href="#ref-for-speculation-rule-urls①">2.5. Processing model</a> <a href="#ref-for-speculation-rule-urls②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="speculation-rule-requirements">
   <b><a href="#speculation-rule-requirements">#speculation-rule-requirements</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-speculation-rule-requirements">2.1. Definitions</a>
    <li><a href="#ref-for-speculation-rule-requirements①">2.4. Parsing</a>
    <li><a href="#ref-for-speculation-rule-requirements②">2.5. Processing model</a> <a href="#ref-for-speculation-rule-requirements③">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="speculation-rule-set">
   <b><a href="#speculation-rule-set">#speculation-rule-set</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-speculation-rule-set">2.2. The script element</a>
    <li><a href="#ref-for-speculation-rule-set①">2.4. Parsing</a> <a href="#ref-for-speculation-rule-set②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="speculation-rule-set-prefetch-rules">
   <b><a href="#speculation-rule-set-prefetch-rules">#speculation-rule-set-prefetch-rules</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-speculation-rule-set-prefetch-rules">2.4. Parsing</a>
    <li><a href="#ref-for-speculation-rule-set-prefetch-rules①">2.5. Processing model</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="speculation-rule-set-prefetch-with-subresources-rules">
   <b><a href="#speculation-rule-set-prefetch-with-subresources-rules">#speculation-rule-set-prefetch-with-subresources-rules</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-speculation-rule-set-prefetch-with-subresources-rules">2.4. Parsing</a>
    <li><a href="#ref-for-speculation-rule-set-prefetch-with-subresources-rules①">2.5. Processing model</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="the-scripts-result">
   <b><a href="#the-scripts-result">#the-scripts-result</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-the-scripts-result">2.3. Prepare a script</a> <a href="#ref-for-the-scripts-result①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="parse-speculation-rules">
   <b><a href="#parse-speculation-rules">#parse-speculation-rules</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-parse-speculation-rules">2.3. Prepare a script</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="parse-a-speculation-rule">
   <b><a href="#parse-a-speculation-rule">#parse-a-speculation-rule</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-parse-a-speculation-rule">2.4. Parsing</a> <a href="#ref-for-parse-a-speculation-rule①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="document-list-of-speculation-rule-sets">
   <b><a href="#document-list-of-speculation-rule-sets">#document-list-of-speculation-rule-sets</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-document-list-of-speculation-rule-sets">2.3. Prepare a script</a>
    <li><a href="#ref-for-document-list-of-speculation-rule-sets①">2.5. Processing model</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="consider-speculation">
   <b><a href="#consider-speculation">#consider-speculation</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-consider-speculation">2.5. Processing model</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="browsing-context-loading-mode">
   <b><a href="#browsing-context-loading-mode">#browsing-context-loading-mode</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-browsing-context-loading-mode">3. Prerendering browsing contexts</a> <a href="#ref-for-browsing-context-loading-mode①">(2)</a> <a href="#ref-for-browsing-context-loading-mode②">(3)</a> <a href="#ref-for-browsing-context-loading-mode③">(4)</a> <a href="#ref-for-browsing-context-loading-mode④">(5)</a> <a href="#ref-for-browsing-context-loading-mode⑤">(6)</a>
    <li><a href="#ref-for-browsing-context-loading-mode⑥">4.2. Redirect handling</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="prerendering-browsing-context">
   <b><a href="#prerendering-browsing-context">#prerendering-browsing-context</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-prerendering-browsing-context">3. Prerendering browsing contexts</a> <a href="#ref-for-prerendering-browsing-context①">(2)</a> <a href="#ref-for-prerendering-browsing-context②">(3)</a> <a href="#ref-for-prerendering-browsing-context③">(4)</a> <a href="#ref-for-prerendering-browsing-context④">(5)</a>
    <li><a href="#ref-for-prerendering-browsing-context⑤">4.1. Allowing activation in place of navigation</a> <a href="#ref-for-prerendering-browsing-context⑥">(2)</a> <a href="#ref-for-prerendering-browsing-context⑦">(3)</a>
    <li><a href="#ref-for-prerendering-browsing-context⑧">4.2. Redirect handling</a> <a href="#ref-for-prerendering-browsing-context⑨">(2)</a> <a href="#ref-for-prerendering-browsing-context①⓪">(3)</a> <a href="#ref-for-prerendering-browsing-context①①">(4)</a>
    <li><a href="#ref-for-prerendering-browsing-context①②">4.3. Maintaining a trivial session history</a> <a href="#ref-for-prerendering-browsing-context①③">(2)</a> <a href="#ref-for-prerendering-browsing-context①④">(3)</a>
    <li><a href="#ref-for-prerendering-browsing-context①⑤">4.4. Preventing non-HTTP(S) navigations</a> <a href="#ref-for-prerendering-browsing-context①⑥">(2)</a> <a href="#ref-for-prerendering-browsing-context①⑦">(3)</a>
    <li><a href="#ref-for-prerendering-browsing-context①⑧">5. Preventing nonsensical behaviors</a>
    <li><a href="#ref-for-prerendering-browsing-context①⑨">5.1. APIs for creating and navigating browsing contexts by name</a> <a href="#ref-for-prerendering-browsing-context②⓪">(2)</a>
    <li><a href="#ref-for-prerendering-browsing-context②①">6. Preventing intrusive behaviors</a>
    <li><a href="#ref-for-prerendering-browsing-context②②">6.1. Downloading resources</a> <a href="#ref-for-prerendering-browsing-context②③">(2)</a>
    <li><a href="#ref-for-prerendering-browsing-context②④">6.2. User prompts</a> <a href="#ref-for-prerendering-browsing-context②⑤">(2)</a>
    <li><a href="#ref-for-prerendering-browsing-context②⑥">6.3. Waiting before permissions checks</a>
    <li><a href="#ref-for-prerendering-browsing-context②⑦">6.3.1. Geolocation API</a> <a href="#ref-for-prerendering-browsing-context②⑧">(2)</a> <a href="#ref-for-prerendering-browsing-context②⑨">(3)</a>
    <li><a href="#ref-for-prerendering-browsing-context③⓪">6.3.2. Web Serial API</a> <a href="#ref-for-prerendering-browsing-context③①">(2)</a>
    <li><a href="#ref-for-prerendering-browsing-context③②">6.3.3. Notifications API</a>
    <li><a href="#ref-for-prerendering-browsing-context③③">6.3.4. Web MIDI API</a>
    <li><a href="#ref-for-prerendering-browsing-context③④">6.3.5. Idle Detection API</a>
    <li><a href="#ref-for-prerendering-browsing-context③⑤">6.3.6. Activation-gated APIs</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="prerendering-browsing-context-empty">
   <b><a href="#prerendering-browsing-context-empty">#prerendering-browsing-context-empty</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-prerendering-browsing-context-empty">3. Prerendering browsing contexts</a>
    <li><a href="#ref-for-prerendering-browsing-context-empty①">4.1. Allowing activation in place of navigation</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="document-prerendering-browsing-contexts-map">
   <b><a href="#document-prerendering-browsing-contexts-map">#document-prerendering-browsing-contexts-map</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-document-prerendering-browsing-contexts-map">3. Prerendering browsing contexts</a> <a href="#ref-for-document-prerendering-browsing-contexts-map①">(2)</a>
    <li><a href="#ref-for-document-prerendering-browsing-contexts-map②">4.1. Allowing activation in place of navigation</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="document-post-prerendering-activation-steps-list">
   <b><a href="#document-post-prerendering-activation-steps-list">#document-post-prerendering-activation-steps-list</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-document-post-prerendering-activation-steps-list">3. Prerendering browsing contexts</a> <a href="#ref-for-document-post-prerendering-activation-steps-list①">(2)</a> <a href="#ref-for-document-post-prerendering-activation-steps-list②">(3)</a> <a href="#ref-for-document-post-prerendering-activation-steps-list③">(4)</a>
    <li><a href="#ref-for-document-post-prerendering-activation-steps-list④">4.5. Cleanup upon discarding a Document</a>
    <li><a href="#ref-for-document-post-prerendering-activation-steps-list⑤">6.3.2. Web Serial API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="platform-object-post-prerendering-activation-steps-list">
   <b><a href="#platform-object-post-prerendering-activation-steps-list">#platform-object-post-prerendering-activation-steps-list</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-platform-object-post-prerendering-activation-steps-list">6.1. Downloading resources</a>
    <li><a href="#ref-for-platform-object-post-prerendering-activation-steps-list①">6.3.1. Geolocation API</a> <a href="#ref-for-platform-object-post-prerendering-activation-steps-list②">(2)</a> <a href="#ref-for-platform-object-post-prerendering-activation-steps-list③">(3)</a>
    <li><a href="#ref-for-platform-object-post-prerendering-activation-steps-list④">6.3.2. Web Serial API</a>
    <li><a href="#ref-for-platform-object-post-prerendering-activation-steps-list⑤">6.3.3. Notifications API</a>
    <li><a href="#ref-for-platform-object-post-prerendering-activation-steps-list⑥">6.3.4. Web MIDI API</a>
    <li><a href="#ref-for-platform-object-post-prerendering-activation-steps-list⑦">6.3.5. Idle Detection API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="create-a-prerendering-browsing-context">
   <b><a href="#create-a-prerendering-browsing-context">#create-a-prerendering-browsing-context</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-create-a-prerendering-browsing-context">1. Link type "prerender"</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="prerendering-browsing-context-activate">
   <b><a href="#prerendering-browsing-context-activate">#prerendering-browsing-context-activate</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-prerendering-browsing-context-activate">3. Prerendering browsing contexts</a>
    <li><a href="#ref-for-prerendering-browsing-context-activate①">4.1. Allowing activation in place of navigation</a> <a href="#ref-for-prerendering-browsing-context-activate②">(2)</a> <a href="#ref-for-prerendering-browsing-context-activate③">(3)</a>
    <li><a href="#ref-for-prerendering-browsing-context-activate④">4.2. Redirect handling</a> <a href="#ref-for-prerendering-browsing-context-activate⑤">(2)</a>
    <li><a href="#ref-for-prerendering-browsing-context-activate⑥">6.1. Downloading resources</a>
    <li><a href="#ref-for-prerendering-browsing-context-activate⑦">6.3. Waiting before permissions checks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-document-prerendering">
   <b><a href="#dom-document-prerendering">#dom-document-prerendering</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-document-prerendering">3. Prerendering browsing contexts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-document-onprerenderingchange">
   <b><a href="#dom-document-onprerenderingchange">#dom-document-onprerenderingchange</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-document-onprerenderingchange">3. Prerendering browsing contexts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="eventdef-document-prerenderingchange">
   <b><a href="#eventdef-document-prerenderingchange">#eventdef-document-prerenderingchange</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-eventdef-document-prerenderingchange">3. Prerendering browsing contexts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="can-activate-a-prerender">
   <b><a href="#can-activate-a-prerender">#can-activate-a-prerender</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-can-activate-a-prerender">4.1. Allowing activation in place of navigation</a>
    <li><a href="#ref-for-can-activate-a-prerender①">4.2. Redirect handling</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="post-prerendering-activation-geolocation-watch-process-id">
   <b><a href="#post-prerendering-activation-geolocation-watch-process-id">#post-prerendering-activation-geolocation-watch-process-id</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-post-prerendering-activation-geolocation-watch-process-id">6.3.1. Geolocation API</a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

document.body.addEventListener("click", function(e) {
    var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
    // Find the dfn element or panel, if any, that was clicked on.
    var el = e.target;
    var target;
    var hitALink = false;
    while(el.parentElement) {
        if(el.tagName == "A") {
            // Clicking on a link in a <dfn> shouldn't summon the panel
            hitALink = true;
        }
        if(el.classList.contains("dfn-paneled")) {
            target = "dfn";
            break;
        }
        if(el.classList.contains("dfn-panel")) {
            target = "dfn-panel";
            break;
        }
        el = el.parentElement;
    }
    if(target != "dfn-panel") {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
            el.classList.remove("on");
            el.classList.remove("activated");
        });
    }
    if(target == "dfn" && !hitALink) {
        // open the panel
        var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
        if(dfnPanel) {
            dfnPanel.classList.add("on");
            var rect = el.getBoundingClientRect();
            dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
            dfnPanel.style.top = window.scrollY + rect.top + "px";
            var panelRect = dfnPanel.getBoundingClientRect();
            var panelWidth = panelRect.right - panelRect.left;
            if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                // Reposition, because the panel is overflowing
                dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
            }
        } else {
            console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
        }
    } else if(target == "dfn-panel") {
        // Switch it to "activated" state, which pins it.
        el.classList.add("activated");
        el.style.left = null;
        el.style.top = null;
    }

});
</script>
<script>/* script-var-click-highlighting */

    document.addEventListener("click", e=>{
        if(e.target.nodeName == "VAR") {
            highlightSameAlgoVars(e.target);
        }
    });
    {
        const indexCounts = new Map();
        const indexNames = new Map();
        function highlightSameAlgoVars(v) {
            // Find the algorithm container.
            let algoContainer = null;
            let searchEl = v;
            while(algoContainer == null && searchEl != document.body) {
                searchEl = searchEl.parentNode;
                if(searchEl.hasAttribute("data-algorithm")) {
                    algoContainer = searchEl;
                }
            }

            // Not highlighting document-global vars,
            // too likely to be unrelated.
            if(algoContainer == null) return;

            const algoName = algoContainer.getAttribute("data-algorithm");
            const varName = getVarName(v);
            const addClass = !v.classList.contains("selected");
            let highlightClass = null;
            if(addClass) {
                const index = chooseHighlightIndex(algoName, varName);
                indexCounts.get(algoName)[index] += 1;
                indexNames.set(algoName+"///"+varName, index);
                highlightClass = nameFromIndex(index);
            } else {
                const index = previousHighlightIndex(algoName, varName);
                indexCounts.get(algoName)[index] -= 1;
                highlightClass = nameFromIndex(index);
            }

            // Find all same-name vars, and toggle their class appropriately.
            for(const el of algoContainer.querySelectorAll("var")) {
                if(getVarName(el) == varName) {
                    el.classList.toggle("selected", addClass);
                    el.classList.toggle(highlightClass, addClass);
                }
            }
        }
        function getVarName(el) {
            return el.textContent.replace(/(\s|\xa0)+/, " ").trim();
        }
        function chooseHighlightIndex(algoName, varName) {
            let indexes = null;
            if(indexCounts.has(algoName)) {
                indexes = indexCounts.get(algoName);
            } else {
                // 7 classes right now
                indexes = [0,0,0,0,0,0,0];
                indexCounts.set(algoName, indexes);
            }

            // If the element was recently unclicked,
            // *and* that color is still unclaimed,
            // give it back the same color.
            const lastIndex = previousHighlightIndex(algoName, varName);
            if(indexes[lastIndex] === 0) return lastIndex;

            // Find the earliest index with the lowest count.
            const minCount = Math.min.apply(null, indexes);
            let index = null;
            for(var i = 0; i < indexes.length; i++) {
                if(indexes[i] == minCount) {
                    return i;
                }
            }
        }
        function previousHighlightIndex(algoName, varName) {
            return indexNames.get(algoName+"///"+varName);
        }
        function nameFromIndex(index) {
            return "selected" + index;
        }
    }
    </script>